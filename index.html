<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Agente de PontuaÃ§Ã£o â€” Streamers Atlanta</title>
  <style>
    :root{
      --bg:#0a0a0a;
      --card:#1a1a2e;
      --text:#e8ecff;
      --muted:#aab2d5;
      --ok:#48d597;
      --bad:#ff6b6b;
      --accent:#7c5cff;
      --border: rgba(255,255,255,.15);
      --chip: rgba(255,255,255,.08);
      --buffalo-red: #8b0000;
      --buffalo-orange: #ff4500;
      --buffalo-gold: #ffd700;
    }
    
    *{ box-sizing:border-box; }
    
    body{
      margin:0;
      font-family: 'Segoe UI', system-ui, -apple-system, Arial, sans-serif;
      color:var(--text);
      background: 
        linear-gradient(135deg, rgba(10,10,10,.98) 0%, rgba(26,26,46,.95) 50%, rgba(10,10,10,.98) 100%),
        radial-gradient(ellipse at 20% 30%, rgba(139,0,0,.2) 0%, transparent 60%),
        radial-gradient(ellipse at 80% 70%, rgba(255,69,0,.15) 0%, transparent 60%),
        var(--bg);
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }

    .buffalo-hero {
      position: fixed;
      top: 0;
      right: -200px;
      width: 800px;
      height: 100vh;
      background: url('https://cdnb.artstation.com/p/assets/images/images/046/242/845/large/lucas-sant-ana-tatonka.jpg?1648488053') center/cover no-repeat;
      opacity: 0.25;
      z-index: -2;
      will-change: transform, opacity;
      transform: translateZ(0);
      backface-visibility: hidden;
      filter: 
        contrast(1.6) 
        brightness(0.35) 
        sepia(1) 
        hue-rotate(320deg) 
        saturate(1.8)
        drop-shadow(0 0 20px rgba(139,0,0,.4));
      animation: breathe 12s ease-in-out infinite;
    }

    .buffalo-hero::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        linear-gradient(90deg, rgba(10,10,10,.9) 0%, rgba(10,10,10,.3) 40%, transparent 70%),
        radial-gradient(circle at 60% 40%, rgba(139,0,0,.4) 0%, transparent 50%);
      z-index: 1;
    }

    .buffalo-skull {
      position: fixed;
      top: 80px;
      right: 100px;
      width: 300px;
      height: 300px;
      background: url('https://wallpapers.com/images/high/buffalo-skull-art-1d68pwdvaojagn6y.jpg') center/contain no-repeat;
      opacity: 0.15;
      z-index: -1;
      will-change: transform;
      transform: translateZ(0);
      backface-visibility: hidden;
      filter: 
        contrast(2) 
        brightness(0.3) 
        sepia(1) 
        hue-rotate(320deg) 
        drop-shadow(0 0 30px rgba(139,0,0,.5));
      animation: float 15s ease-in-out infinite;
    }

    .particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -1;
      will-change: transform;
      transform: translateZ(0);
    }

    .particle {
      position: absolute;
      border-radius: 50%;
      will-change: transform, opacity;
      transform: translateZ(0);
      width: 4px;
      height: 4px;
      background: radial-gradient(circle, rgba(139,0,0,.8), transparent);
      animation: particle-float 8s linear infinite;
    }

    @keyframes breathe {
      0%, 100% { transform: scale(1) translateX(0) translateZ(0); opacity: 0.25; }
      50% { transform: scale(1.08) translateX(-30px) translateZ(0); opacity: 0.35; }
    }

    @keyframes float {
      0%, 100% { transform: translateY(0) rotate(0deg) translateZ(0); }
      33% { transform: translateY(-20px) rotate(3deg) translateZ(0); }
      66% { transform: translateY(15px) rotate(-2deg) translateZ(0); }
    }

    @keyframes particle-float {
      0% { 
        transform: translateY(100vh) translateX(0) scale(0) translateZ(0);
        opacity: 0;
      }
      10% {
        opacity: 1;
        transform: scale(1) translateZ(0);
      }
      90% {
        opacity: 1;
      }
      100% { 
        transform: translateY(-100px) translateX(50px) scale(0) translateZ(0);
        opacity: 0;
      }
    }

    .wrap{
      max-width: 1400px;
      margin: 0 auto;
      padding: 30px 20px 80px;
      position: relative;
      z-index: 1;
      will-change: transform;
      transform: translateZ(0);
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
      position: relative;
    }

    .header::before {
      content: '';
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      width: 200px;
      height: 4px;
      background: linear-gradient(90deg, transparent, var(--buffalo-red), var(--buffalo-orange), var(--buffalo-red), transparent);
      border-radius: 2px;
      will-change: box-shadow;
      box-shadow: 0 0 20px rgba(139,0,0,.5);
    }

    h1{
      margin: 20px 0 15px;
      font-size: 32px;
      font-weight: 900;
      letter-spacing: 1px;
      text-transform: uppercase;
      background: linear-gradient(135deg, var(--buffalo-gold), var(--buffalo-orange), var(--buffalo-red));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      position: relative;
      will-change: transform;
      text-shadow: 0 0 30px rgba(139,0,0,.3);
    }

    h1::after {
      content: 'ğŸƒ';
      position: absolute;
      right: -50px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 40px;
      will-change: transform;
      filter: drop-shadow(0 0 15px rgba(255,69,0,.8));
      animation: pulse 4s ease-in-out infinite;
    }

    .sub{
      margin: 0 auto 30px;
      color: var(--muted);
      line-height: 1.6;
      max-width: 800px;
      font-size: 16px;
      text-shadow: 0 0 10px rgba(0,0,0,.8);
    }

    .grid{
      display: grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 20px;
    }

    .card{
      background: 
        linear-gradient(135deg, rgba(26,26,46,.95) 0%, rgba(20,20,40,.98) 100%);
      border: 2px solid transparent;
      background-clip: padding-box;
      border-radius: 20px;
      padding: 25px;
      backdrop-filter: blur(20px);
      position: relative;
      box-shadow: 
        0 15px 35px rgba(0,0,0,.4),
        inset 0 1px 0 rgba(255,255,255,.1),
        0 0 0 1px rgba(139,0,0,.2);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      will-change: transform;
      transform: translateZ(0);
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(circle at 20% 20%, rgba(139,0,0,.08) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(255,69,0,.05) 0%, transparent 50%);
      border-radius: 20px;
      pointer-events: none;
      z-index: -1;
    }

    .card:hover {
      transform: translateY(-5px) translateZ(0);
      box-shadow: 
        0 25px 50px rgba(0,0,0,.5),
        inset 0 1px 0 rgba(255,255,255,.15),
        0 0 0 2px rgba(139,0,0,.4),
        0 0 30px rgba(139,0,0,.2);
    }

    .card h2{
      margin: 0 0 20px;
      font-size: 18px;
      font-weight: 900;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--buffalo-orange);
      position: relative;
      text-shadow: 0 0 10px rgba(255,69,0,.3);
    }

    .card h2::after {
      content: '';
      position: absolute;
      bottom: -8px;
      left: 0;
      width: 60px;
      height: 2px;
      background: linear-gradient(90deg, var(--buffalo-red), var(--buffalo-orange));
      border-radius: 1px;
    }

    label{
      display: block;
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 8px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    input, select, textarea, button{
      width: 100%;
      background: 
        linear-gradient(135deg, rgba(255,255,255,.12) 0%, rgba(255,255,255,.08) 100%);
      border: 2px solid rgba(139,0,0,.4);
      color: var(--text);
      padding: 15px;
      border-radius: 12px;
      outline: none;
      font: inherit;
      font-size: 14px;
      transition: all 0.3s ease;
      box-shadow: inset 0 2px 4px rgba(0,0,0,.3);
      will-change: transform, border-color, box-shadow;
    }

    select {
      background: 
        linear-gradient(135deg, rgba(255,255,255,.15) 0%, rgba(255,255,255,.1) 100%);
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23ff4500' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 12px center;
      background-size: 16px;
      padding-right: 40px;
    }

    select option {
      background: rgba(26,26,46,.98);
      color: var(--text);
      padding: 12px 15px;
      border: none;
      font-size: 14px;
      font-weight: 500;
    }

    select option:hover,
    select option:focus,
    select option:checked {
      background: linear-gradient(135deg, rgba(255,69,0,.3) 0%, rgba(139,0,0,.2) 100%);
      color: var(--buffalo-gold);
    }

    input:focus, select:focus, textarea:focus {
      border-color: var(--buffalo-orange);
      transform: translateY(-2px);
      box-shadow: 
        inset 0 2px 4px rgba(0,0,0,.3),
        0 0 0 3px rgba(255,69,0,.2),
        0 0 20px rgba(255,69,0,.3);
    }

    textarea{ 
      min-height: 180px; 
      resize: vertical; 
      font-family: 'Courier New', monospace;
    }

    button{
      cursor: pointer;
      border: 2px solid var(--buffalo-orange);
      background: 
        linear-gradient(135deg, rgba(255,69,0,.3) 0%, rgba(139,0,0,.2) 100%);
      font-weight: 900;
      text-transform: uppercase;
      letter-spacing: 1px;
      position: relative;
      overflow: hidden;
      will-change: transform, border-color, background;
    }

    button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.2), transparent);
      transition: left 0.6s ease;
      will-change: left;
    }

    button:hover::before {
      left: 100%;
    }

    button:hover {
      border-color: var(--buffalo-gold);
      background: 
        linear-gradient(135deg, rgba(255,215,0,.4) 0%, rgba(255,69,0,.3) 100%);
      transform: translateY(-3px);
      box-shadow: 
        0 8px 25px rgba(255,69,0,.3),
        0 0 30px rgba(255,215,0,.2);
    }

    button.secondary{
      border: 2px solid rgba(255,255,255,.3);
      background: 
        linear-gradient(135deg, rgba(255,255,255,.1) 0%, rgba(255,255,255,.05) 100%);
    }

    button.secondary:hover {
      border-color: var(--buffalo-orange);
      background: 
        linear-gradient(135deg, rgba(255,69,0,.2) 0%, rgba(255,255,255,.1) 100%);
    }

    button.danger{
      border: 2px solid #ff6b6b;
      background: 
        linear-gradient(135deg, rgba(255,107,107,.3) 0%, rgba(255,107,107,.15) 100%);
    }

    button.danger:hover {
      border-color: #ff4757;
      background: 
        linear-gradient(135deg, rgba(255,71,87,.4) 0%, rgba(255,107,107,.25) 100%);
      box-shadow: 
        0 8px 25px rgba(255,107,107,.3),
        0 0 30px rgba(255,71,87,.2);
    }

    .row{ display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
    .row-3{ display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; }
    .span4{ grid-column: span 4; }
    .span6{ grid-column: span 6; }
    .span8{ grid-column: span 8; }
    .span12{ grid-column: span 12; }

    .pill{
      display: inline-flex; 
      align-items: center; 
      gap: 8px;
      padding: 8px 16px; 
      border-radius: 25px; 
      border: 2px solid rgba(139,0,0,.4);
      background: 
        linear-gradient(135deg, rgba(139,0,0,.15) 0%, rgba(255,69,0,.1) 100%);
      color: var(--buffalo-orange); 
      font-size: 13px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      box-shadow: 
        0 4px 15px rgba(0,0,0,.2),
        inset 0 1px 0 rgba(255,255,255,.1);
    }

    .kpis{ 
      display: flex; 
      gap: 20px; 
      flex-wrap: wrap; 
      margin: 20px 0;
    }

    .kpi{
      flex: 1 1 200px;
      background: 
        linear-gradient(135deg, rgba(255,255,255,.08) 0%, rgba(255,255,255,.04) 100%);
      border: 2px solid rgba(139,0,0,.3);
      border-radius: 16px;
      padding: 20px;
      position: relative;
      box-shadow: 
        0 8px 25px rgba(0,0,0,.3),
        inset 0 1px 0 rgba(255,255,255,.1);
      transition: all 0.3s ease;
      will-change: transform, border-color, box-shadow;
    }

    .kpi::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--buffalo-red), var(--buffalo-orange), var(--buffalo-gold));
      border-radius: 16px 16px 0 0;
    }

    .kpi:hover {
      transform: translateY(-3px);
      border-color: var(--buffalo-orange);
      box-shadow: 
        0 15px 35px rgba(0,0,0,.4),
        inset 0 1px 0 rgba(255,255,255,.15),
        0 0 25px rgba(255,69,0,.2);
    }

    .kpi .k{ 
      color: var(--muted); 
      font-size: 12px; 
      margin-bottom: 12px;
      text-transform: uppercase;
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    .kpi .v{ 
      font-weight: 900; 
      font-size: 28px;
      background: linear-gradient(135deg, var(--buffalo-gold), var(--buffalo-orange));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 0 20px rgba(255,69,0,.3);
    }

    table{ 
      width: 100%; 
      border-collapse: collapse; 
      font-size: 13px;
      background: rgba(0,0,0,.3);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 8px 25px rgba(0,0,0,.3);
    }

    th, td{ 
      padding: 15px 12px; 
      border-bottom: 1px solid rgba(139,0,0,.2); 
      vertical-align: top; 
    }

    th{ 
      color: var(--buffalo-orange); 
      text-align: left; 
      font-weight: 900;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      background: 
        linear-gradient(135deg, rgba(139,0,0,.2) 0%, rgba(255,69,0,.1) 100%);
      font-size: 12px;
    }

    tr:hover {
      background: rgba(139,0,0,.1);
    }

    .tag-ok{ 
      color: var(--ok);
      font-weight: 700;
      text-shadow: 0 0 8px rgba(72,213,151,.4);
    }

    .tag-no{ 
      color: var(--bad);
      font-weight: 700;
      text-shadow: 0 0 8px rgba(255,107,107,.4);
    }

    .help{ 
      font-size: 13px; 
      color: var(--muted); 
      line-height: 1.6;
      margin-top: 15px;
    }

    .mono{ 
      font-family: 'Courier New', 'Monaco', monospace;
      font-size: 13px;
    }

    ::-webkit-scrollbar {
      width: 12px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(0,0,0,.3);
      border-radius: 6px;
    }

    ::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, var(--buffalo-red), var(--buffalo-orange));
      border-radius: 6px;
      border: 2px solid rgba(0,0,0,.2);
    }

    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(135deg, var(--buffalo-orange), var(--buffalo-gold));
    }

    @keyframes pulse {
      0%, 100% { transform: translateY(-50%) scale(1) translateZ(0); }
      50% { transform: translateY(-50%) scale(1.15) translateZ(0); }
    }

    @media (max-width: 1200px){
      .buffalo-hero {
        right: -300px;
        width: 600px;
        opacity: 0.15;
      }
      
      .buffalo-skull {
        width: 200px;
        height: 200px;
        right: 50px;
        top: 60px;
      }
    }

    @media (max-width: 980px){
      .span4, .span6, .span8{ grid-column: span 12; }
      .row{ grid-template-columns: 1fr; }
      .row-3{ grid-template-columns: 1fr; }
      
      .buffalo-hero {
        display: none;
      }
      
      .buffalo-skull {
        width: 150px;
        height: 150px;
        right: 20px;
        top: 40px;
        opacity: 0.1;
      }

      h1 {
        font-size: 24px;
      }

      h1::after {
        position: static;
        margin-left: 15px;
        font-size: 30px;
      }

      .wrap {
        padding: 20px 15px 60px;
      }

      .grid {
        gap: 15px;
      }

      .card {
        padding: 20px;
      }
    }

    .storage-indicator {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: linear-gradient(135deg, rgba(139,0,0,.9), rgba(255,69,0,.8));
      color: white;
      padding: 10px 15px;
      border-radius: 25px;
      font-size: 12px;
      font-weight: 600;
      box-shadow: 0 4px 15px rgba(0,0,0,.3);
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .storage-indicator.show {
      opacity: 1;
    }

    .manual-section {
      background: rgba(255,69,0,.05);
      border: 1px solid rgba(255,69,0,.2);
      border-radius: 12px;
      padding: 15px;
      margin: 15px 0;
    }

    .manual-section h3 {
      margin: 0 0 15px;
      font-size: 14px;
      color: var(--buffalo-orange);
      text-transform: uppercase;
      font-weight: 700;
    }
  </style>
</head>
<body>
  <div class="buffalo-hero"></div>
  <div class="buffalo-skull"></div>
  <div class="particles" id="particles"></div>
  <div class="storage-indicator" id="storageIndicator">ğŸ’¾ Dados salvos automaticamente</div>

  <div class="wrap">
    <div class="header">
      <h1>Agente de PontuaÃ§Ã£o â€” Streamers Atlanta</h1>
      <p class="sub">
        Sistema Ã©pico de pontuaÃ§Ã£o para streamers com o poder do BÃºfalo Atlanta. 
        Cole os lanÃ§amentos, escolha streamer e perÃ­odo, e deixe a magia acontecer.
      </p>
    </div>

    <div class="grid">
      <div class="card span4">
        <h2>âš”ï¸ Streamer e Ciclo</h2>
        <div class="row">
          <div>
            <label>Streamer Ativo</label>
            <select id="streamerSelect"></select>
          </div>
          <div>
            <label>Novo Streamer</label>
            <input id="newStreamer" placeholder="Ex.: Lince" />
          </div>
        </div>
        <div class="row" style="margin-top:15px;">
          <button id="addStreamerBtn">ğŸ›¡ï¸ Adicionar Streamer</button>
          <button id="removeStreamerBtn" class="danger">âš”ï¸ Remover Streamer</button>
        </div>

        <hr style="border:none;border-top:2px solid rgba(139,0,0,.3); margin:25px 0;">

        <div class="row">
          <div>
            <label>Ciclo</label>
            <select id="periodo">
              <option value="dia">Dia</option>
              <option value="semanal">Semanal</option>
              <option value="mensal">Mensal</option>
            </select>
          </div>
          <div>
            <label>Data de ReferÃªncia</label>
            <input id="refDate" type="date" value="2026-01-15" />
          </div>
        </div>

        <div class="manual-section">
          <h3>ğŸ† PontuaÃ§Ã£o Anterior</h3>
          <label>Total de pontos anteriores</label>
          <input id="pontosAnteriores" type="number" min="0" placeholder="Ex.: 150" />
          <button id="updatePontosBtn" style="margin-top:10px;">ğŸ’ Atualizar Pontos</button>
        </div>

        <div style="display:flex; gap:15px; flex-wrap:wrap; margin-top:20px;">
          <span class="pill" id="pillPeriodo">â€”</span>
          <span class="pill">ğŸ¯ Sistema Atlanta Ativo</span>
        </div>
      </div>

      <div class="card span8">
        <h2>ğŸ”¥ Novos LanÃ§amentos (Poder Bruto)</h2>

        <label for="bulkInput">Cole aqui os lanÃ§amentos do streamer (logs do Discord/WhatsApp)</label>
        <textarea id="bulkInput" class="mono" placeholder="Exemplo Ã©pico (como o do Lince):

Lince: https://vt.tiktok.com/ZS53TNw6w/
[00:29]Lince: 1 vÃ­deo tik tok
[00:29]Lince: https://vt.tiktok.com/ZSHoreBgvRj7t-xAR4x/
[00:29]Lince: 1 story tik tok
[00:30]Lince: 1 story Instagram
[00:31]Lince: 1 reel Instagram
[00:31]Lince: 1 POST Instagram
[00:32]Lince: 1 vÃ­deo YouTube
[00:32]Lince: 1 short YouTube
[00:32]Lince: 1 POST YouTube
[00:33]Lince: 1 vÃ­deo Kwai
[00:34]Lince: 1 vÃ­deo Kick

ğŸ”¥ PODER ESPECIAL:
live 1: 4h
views youtube: 1200
raid twitch x2
indicaÃ§Ã£o x3"></textarea>

        <div class="row" style="margin-top:20px;">
          <button id="processBulkBtn">âš¡ PROCESSAR TEXTO âš¡</button>
          <button id="importJsonBtn" class="secondary">ğŸ“¥ IMPORTAR JSON</button>
        </div>

        <div class="manual-section">
          <h3>ğŸ“º Adicionar Manualmente</h3>
          <div class="row-3">
            <div>
              <label>Lives (horas)</label>
              <input id="manualLiveHours" type="number" min="0" step="0.5" placeholder="Ex.: 4.5" />
            </div>
            <div>
              <label>Views</label>
              <input id="manualViews" type="number" min="0" placeholder="Ex.: 1200" />
            </div>
            <div>
              <label>Plataforma</label>
              <select id="manualPlatform">
                <option value="twitch">Twitch</option>
                <option value="youtube">YouTube</option>
                <option value="tiktok">TikTok</option>
                <option value="instagram">Instagram</option>
                <option value="kwai">Kwai</option>
                <option value="kick">Kick</option>
              </select>
            </div>
          </div>
          <div class="row" style="margin-top:15px;">
            <button id="addManualLiveBtn">ğŸ”´ Adicionar Live</button>
            <button id="addManualViewsBtn">ğŸ‘ï¸ Adicionar Views</button>
          </div>
          <div style="margin-top:20px; padding:15px; background:rgba(139,0,0,.1); border-left:4px solid var(--buffalo-red); border-radius:8px;">
            <label style="display:block; margin-bottom:10px;">âš¡ RAID para @ğŸ“¸ãƒ»Streamers e @ğŸ’ãƒ»Streamers Oficiais (8 pontos)</label>
            <p style="font-size:12px; color:var(--muted); margin-bottom:10px;">âš ï¸ Apenas 1 raid por dia serÃ¡ pontuado</p>
            <div class="row">
              <div>
                <label>Data do RAID</label>
                <input id="manualRaidDate" type="date" />
              </div>
              <div>
                <button id="addManualRaidBtn" style="margin-top:23px;">âš¡ Adicionar RAID</button>
              </div>
            </div>
          </div>
        </div>

        <p class="help" style="margin-top:15px;">
          <strong>ğŸƒ O BÃºfalo Atlanta reconhece AGORA:</strong><br>
          <strong>ğŸ“ TEXTO:</strong> <code>1 vÃ­deo tik tok</code> â€¢ <code>1 story Instagram</code> â€¢ <code>live 1: 4h</code> â€¢ <code>views youtube: 1200</code> â€¢ <code>raid twitch x2</code><br>
          <strong>ğŸ“¥ JSON:</strong> Cole dados estruturados e clique em "IMPORTAR JSON"<br>
          <strong>ğŸ’¡ Exemplo JSON:</strong><br>
          <code style="font-size:11px;">{"atividades":[{"data":"2026-01-15","categoria":"conteudo","plataforma":"tiktok","tipo":"stories"}]}</code><br>
          <strong>Views:</strong> -100: 2pts | +100: 4pts | +350: 6pts | +500: 8pts | +800: 10pts | +1000: 12pts | +2000: 24pts | +3000: 36pts<br>
          <strong>âš¡ RAIDS:</strong> 8 pontos por raid â€¢ <strong>Limite:</strong> Apenas 1 raid por dia serÃ¡ pontuado
        </p>

        <div class="manual-section" style="margin-top:20px;">
          <h3>ğŸ” Debug - Atividades Reconhecidas</h3>
          <textarea id="debugOutput" class="mono" style="min-height:120px;" placeholder="Aqui aparecerÃ£o as atividades reconhecidas pelo sistema..." readonly></textarea>
        </div>
      </div>

      <div class="card span6">
        <h2>ğŸ›¡ï¸ Auditoria de Guerra</h2>
        <table>
          <thead>
            <tr>
              <th>ğŸ“… Data</th>
              <th>âš”ï¸ Categoria</th>
              <th>ğŸŒ Plataforma</th>
              <th>ğŸ¯ Tipo</th>
              <th>âœ… Status</th>
              <th>ğŸ’ Pontos</th>
            </tr>
          </thead>
          <tbody id="auditBody"></tbody>
        </table>
        <div class="row" style="margin-top:20px;">
          <button id="removeSelectedBtn" class="danger">ğŸ—‘ï¸ Remover Selecionados</button>
          <button id="clearAllStreamerBtn" class="danger">ğŸ’¥ Limpar Tudo</button>
        </div>
        <p class="help">
          <strong>ğŸƒ Poder do BÃºfalo:</strong> Selecione itens marcando o checkbox para remover da batalha.
        </p>
      </div>

      <div class="card span6">
        <h2>ğŸ“Š Desempenho Individual</h2>
        
        <div class="row">
          <button id="showWeeklyPerformanceBtn" class="secondary">ğŸ“Š RelatÃ³rio Semanal</button>
          <button id="showMonthlyPerformanceBtn" class="secondary">ğŸ“ˆ RelatÃ³rio Mensal</button>
        </div>

        <div style="margin-top:20px;">
          <label>HistÃ³rico de Performance</label>
          <textarea id="performanceOut" class="mono" placeholder="Clique em um botÃ£o acima para ver o desempenho individual..."></textarea>
        </div>
      </div>

      <div class="card span12">
        <h2>ğŸ‘‘ Resumo Ã‰pico & Mensagem de Guerra</h2>
        <div class="kpis">
          <div class="kpi">
            <div class="k">âš”ï¸ Pontos do Ciclo</div>
            <div class="v" id="kPontosPeriodo">â€”</div>
          </div>
          <div class="kpi">
            <div class="k">ğŸ† Total Acumulado</div>
            <div class="v" id="kTotal">â€”</div>
          </div>
          <div class="kpi">
            <div class="k">ğŸ“¦ ConteÃºdo</div>
            <div class="v" id="kConteudo">â€”</div>
          </div>
          <div class="kpi">
            <div class="k">ğŸ”´ Lives</div>
            <div class="v" id="kLives">â€”</div>
          </div>
          <div class="kpi">
            <div class="k">ğŸ‘ï¸ Views</div>
            <div class="v" id="kViews">â€”</div>
          </div>
          <div class="kpi">
            <div class="k">âš¡ AÃ§Ãµes</div>
            <div class="v" id="kAcoes">â€”</div>
          </div>
        </div>

        <div class="row" style="margin-top:20px;">
          <button id="generateMsgBtn">ğŸ”¥ GERAR MENSAGEM Ã‰PICA</button>
          <button id="copyMsgBtn" class="secondary">ğŸ“‹ COPIAR PODER</button>
        </div>

        <div style="margin-top:15px;">
          <label>Emoji do RelatÃ³rio</label>
          <select id="emojiSelect">
            <optgroup label="ğŸƒ MamÃ­feros Grandes">
              <option value="ğŸƒ">ğŸƒ BÃºfalo</option>
              <option value="ğŸ¦¬">ğŸ¦¬ BisÃ£o</option>
              <option value="ğŸ‚">ğŸ‚ Touro</option>
              <option value="ğŸ„">ğŸ„ Vaca</option>
              <option value="ğŸ˜">ğŸ˜ Elefante</option>
              <option value="ğŸ¦">ğŸ¦ Rinoceronte</option>
              <option value="ğŸ¦›">ğŸ¦› HipopÃ³tamo</option>
              <option value="ğŸ¦’">ğŸ¦’ Girafa</option>
              <option value="ğŸª">ğŸª Camelo</option>
              <option value="ğŸ«">ğŸ« Camelo de 2 Corcovas</option>
            </optgroup>
            <optgroup label="ğŸ¦ Felinos & Predadores">
              <option value="ğŸ¦">ğŸ¦ LeÃ£o</option>
              <option value="ğŸ¯">ğŸ¯ Tigre</option>
              <option value="ğŸ…">ğŸ… Tigre Laranja</option>
              <option value="ğŸ†">ğŸ† Leopardo</option>
              <option value="ğŸ±">ğŸ± Gato</option>
              <option value="ğŸˆ">ğŸˆ Gato DomÃ©stico</option>
              <option value="ğŸˆâ€â¬›">ğŸˆâ€â¬› Gato Preto</option>
            </optgroup>
            <optgroup label="ğŸº Caninos">
              <option value="ğŸº">ğŸº Lobo</option>
              <option value="ğŸ¦Š">ğŸ¦Š Raposa</option>
              <option value="ğŸ¶">ğŸ¶ Cachorro</option>
              <option value="ğŸ•">ğŸ• CÃ£o</option>
              <option value="ğŸ¦®">ğŸ¦® CÃ£o Guia</option>
              <option value="ğŸ•â€ğŸ¦º">ğŸ•â€ğŸ¦º CÃ£o de ServiÃ§o</option>
            </optgroup>
            <optgroup label="ğŸ» Ursos & Grandes MamÃ­feros">
              <option value="ğŸ»">ğŸ» Urso</option>
              <option value="ğŸ»â€â„ï¸">ğŸ»â€â„ï¸ Urso Polar</option>
              <option value="ğŸ¼">ğŸ¼ Panda</option>
              <option value="ğŸ¦˜">ğŸ¦˜ Canguru</option>
              <option value="ğŸ¦¡">ğŸ¦¡ Texugo</option>
              <option value="ğŸ¦«">ğŸ¦« Castor</option>
            </optgroup>
            <optgroup label="ğŸ¦… Aves de Rapina & Voo">
              <option value="ğŸ¦…">ğŸ¦… Ãguia</option>
              <option value="ğŸ¦†">ğŸ¦† Pato</option>
              <option value="ğŸ¦‰">ğŸ¦‰ Coruja</option>
              <option value="ğŸ¦š">ğŸ¦š PavÃ£o</option>
              <option value="ğŸ¦œ">ğŸ¦œ Papagaio</option>
              <option value="ğŸ¦¢">ğŸ¦¢ Cisne</option>
              <option value="ğŸ¦©">ğŸ¦© Flamingo</option>
              <option value="ğŸ¦">ğŸ¦ PÃ¡ssaro</option>
              <option value="ğŸ¦â€â¬›">ğŸ¦â€â¬› Corvo</option>
              <option value="ğŸ§">ğŸ§ Pinguim</option>
              <option value="ğŸ”">ğŸ” Galinha</option>
              <option value="ğŸ“">ğŸ“ Galo</option>
              <option value="ğŸ£">ğŸ£ Pintinho</option>
              <option value="ğŸ¤">ğŸ¤ Pintinho BebÃª</option>
              <option value="ğŸ¥">ğŸ¥ Pintinho Frontal</option>
            </optgroup>
            <optgroup label="ğŸµ Primatas">
              <option value="ğŸµ">ğŸµ Macaco Rosto</option>
              <option value="ğŸ’">ğŸ’ Macaco</option>
              <option value="ğŸ¦">ğŸ¦ Gorila</option>
              <option value="ğŸ¦§">ğŸ¦§ Orangotango</option>
            </optgroup>
            <optgroup label="ğŸ´ Equinos & Ungulados">
              <option value="ğŸ´">ğŸ´ Cavalo Rosto</option>
              <option value="ğŸ">ğŸ Cavalo</option>
              <option value="ğŸ¦„">ğŸ¦„ UnicÃ³rnio</option>
              <option value="ğŸ¦“">ğŸ¦“ Zebra</option>
              <option value="ğŸ—">ğŸ— Javali</option>
              <option value="ğŸ–">ğŸ– Porco</option>
              <option value="ğŸ·">ğŸ· Porco Rosto</option>
            </optgroup>
            <optgroup label="ğŸ¦ RÃ©pteis">
              <option value="ğŸŠ">ğŸŠ Crocodilo</option>
              <option value="ğŸ¢">ğŸ¢ Tartaruga</option>
              <option value="ğŸ¦">ğŸ¦ Lagarto</option>
              <option value="ğŸ">ğŸ Cobra</option>
              <option value="ğŸ²">ğŸ² Rosto de DragÃ£o</option>
              <option value="ğŸ‰">ğŸ‰ DragÃ£o</option>
            </optgroup>
            <optgroup label="ğŸ¸ AnfÃ­bios">
              <option value="ğŸ¸">ğŸ¸ Sapo</option>
            </optgroup>
            <optgroup label="ğŸ™ Vida Marinha">
              <option value="ğŸ‹">ğŸ‹ Baleia</option>
              <option value="ğŸ³">ğŸ³ Baleia Esguichando</option>
              <option value="ğŸ¬">ğŸ¬ Golfinho</option>
              <option value="ğŸ¦­">ğŸ¦­ Foca</option>
              <option value="ğŸŸ">ğŸŸ Peixe</option>
              <option value="ğŸ ">ğŸ  Peixe Tropical</option>
              <option value="ğŸ¡">ğŸ¡ Baiacu</option>
              <option value="ğŸ¦ˆ">ğŸ¦ˆ TubarÃ£o</option>
              <option value="ğŸ™">ğŸ™ Polvo</option>
              <option value="ğŸ¦‘">ğŸ¦‘ Lula</option>
              <option value="ğŸ¦€">ğŸ¦€ Caranguejo</option>
              <option value="ğŸ¦">ğŸ¦ Lagosta</option>
              <option value="ğŸ¦">ğŸ¦ CamarÃ£o</option>
            </optgroup>
            <optgroup label="ğŸ¦‹ Insetos & AracnÃ­deos">
              <option value="ğŸŒ">ğŸŒ Caracol</option>
              <option value="ğŸ¦‹">ğŸ¦‹ Borboleta</option>
              <option value="ğŸ›">ğŸ› Lagarta</option>
              <option value="ğŸœ">ğŸœ Formiga</option>
              <option value="ğŸ">ğŸ Abelha</option>
              <option value="ğŸª²">ğŸª² Besouro</option>
              <option value="ğŸ">ğŸ Joaninha</option>
              <option value="ğŸ¦—">ğŸ¦— Grilo</option>
              <option value="ğŸª³">ğŸª³ Barata</option>
              <option value="ğŸ•·ï¸">ğŸ•·ï¸ Aranha</option>
              <option value="ğŸ•¸ï¸">ğŸ•¸ï¸ Teia de Aranha</option>
              <option value="ğŸ¦‚">ğŸ¦‚ EscorpiÃ£o</option>
              <option value="ğŸ¦Ÿ">ğŸ¦Ÿ Mosquito</option>
              <option value="ğŸª°">ğŸª° Mosca</option>
              <option value="ğŸª±">ğŸª± Minhoca</option>
            </optgroup>
            <optgroup label="ğŸ° Pequenos MamÃ­feros">
              <option value="ğŸ­">ğŸ­ Rato Rosto</option>
              <option value="ğŸ">ğŸ Rato</option>
              <option value="ğŸ€">ğŸ€ Ratazana</option>
              <option value="ğŸ¹">ğŸ¹ Hamster</option>
              <option value="ğŸ°">ğŸ° Coelho Rosto</option>
              <option value="ğŸ‡">ğŸ‡ Coelho</option>
              <option value="ğŸ¿ï¸">ğŸ¿ï¸ Esquilo</option>
              <option value="ğŸ¦”">ğŸ¦” OuriÃ§o</option>
              <option value="ğŸ¦‡">ğŸ¦‡ Morcego</option>
            </optgroup>
          </select>
        </div>

        <div style="margin-top:20px;">
          <label>Mensagem Ã‰pica (Discord / RelatÃ³rio)</label>
          <textarea id="msgOut" class="mono" placeholder="Clique em 'GERAR MENSAGEM Ã‰PICA' para invocar o poder do BÃºfalo..."></textarea>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Sistema de recompensas
    const TABELA_RESGATES = {
      "PIX": [{ nome: "200 reais no pix", pontos: 600, limite: "apenas um resgate por mÃªs" }],
      "CAIXAS": [
        { nome: "1 Caixa de Armas Inicial", pontos: 20 },
        { nome: "1 Caixa de Armas Mediana", pontos: 50 },
        { nome: "1 Caixa de Armas Profissional", pontos: 100 }
      ],
      "PERSONAGEM": [
        { nome: "Tamanho Personalizado", pontos: 100 },
        { nome: "Segundo Personagem (MÃ¡ximo 5 slots)", pontos: 170 },
        { nome: "+ 210 espaÃ§o mochila (30 dias)", pontos: 210 },
        { nome: "+ 280 espaÃ§o mochila (30 dias)", pontos: 280 },
        { nome: "+ 300 espaÃ§o mochila (30 dias)", pontos: 300 },
        { nome: "Segundo Job", pontos: 600 }
      ],
      "CAVALOS": [
        { nome: "Cavalo atÃ© 500 dÃ³lares", pontos: 50 },
        { nome: "Cavalo atÃ© 1000 dÃ³lares", pontos: 100 },
        { nome: "Cavalo atÃ© 2000 dÃ³lares", pontos: 200 }
      ],
      "BARRAS DE OURO": [
        { nome: "30 Barras de Ouro", pontos: 30 },
        { nome: "50 Barras de Ouro", pontos: 50 },
        { nome: "100 Barras de Ouro", pontos: 100 },
        { nome: "150 Barras de Ouro", pontos: 150 },
        { nome: "200 Barras de Ouro", pontos: 200 }
      ],
      "ARMAS": [
        { nome: "Mauser", pontos: 40 },
        { nome: "M1899", pontos: 40 },
        { nome: "PersonalizaÃ§Ã£o de Arma", pontos: 50 },
        { nome: "Faca Personalizada", pontos: 70 },
        { nome: "Rifle de Ferrolho", pontos: 80 },
        { nome: "Repetidora Winchester", pontos: 80 },
        { nome: "Shotgun Double", pontos: 80 },
        { nome: "Revolver Navy", pontos: 400 },
        { nome: "Rolling Block Rifle", pontos: 500 }
      ],
      "CARROÃ‡AS": [
        { nome: "CarroÃ§a (atÃ© 200 gold)", pontos: 200 },
        { nome: "CarroÃ§a (atÃ© 500 gold)", pontos: 500 }
      ],
      "HERANÃ‡AS": [
        { nome: "Vip Ouro", pontos: 100 },
        { nome: "Vip Platina", pontos: 250 },
        { nome: "Vip Diamante", pontos: 500 }
      ]
    };

    function getAvailableRewards(totalPontos) {
      const available = [];
      Object.keys(TABELA_RESGATES).forEach(categoria => {
        TABELA_RESGATES[categoria].forEach(item => {
          if (totalPontos >= item.pontos) {
            available.push({ ...item, categoria });
          }
        });
      });
      return available.sort((a, b) => b.pontos - a.pontos).slice(0, 3);
    }

    function getRewardsText(totalPontos) {
      const rewards = getAvailableRewards(totalPontos);
      if (rewards.length === 0) {
        return "Continue acumulando pontos para desbloquear resgates! ğŸ¯";
      }
      let text = "ğŸ **PARABÃ‰NS! VOCÃŠ JÃ PODE RESGATAR:**\\n\\n";
      rewards.forEach((reward, idx) => {
        text += `**${idx + 1}.** ${reward.nome} - **${reward.pontos} pontos** âœ…\\n`;
      });
      text += "\\n*ğŸ’ Entre em contato com a administraÃ§Ã£o para efetuar seus resgates!*\\n";
      return text;
    }

    // Sistema de dados
    const STORAGE_KEY = "atlanta_buffalo_v8";
    const BACKUP_KEY = "atlanta_buffalo_backup_v8";

    function saveStateEnhanced(state) {
      try {
        const compressedState = JSON.stringify(state);
        localStorage.setItem(STORAGE_KEY, compressedState);
        
        if (!saveStateEnhanced.lastBackup || Date.now() - saveStateEnhanced.lastBackup > 30000) {
          const backup = { data: state, timestamp: Date.now(), version: "8.0" };
          localStorage.setItem(BACKUP_KEY, JSON.stringify(backup));
          saveStateEnhanced.lastBackup = Date.now();
        }
        
        showStorageIndicator("ğŸ’¾ Dados salvos com seguranÃ§a!");
        return true;
      } catch (error) {
        console.error("Erro ao salvar dados:", error);
        showStorageIndicator("âŒ Erro ao salvar dados!", true);
        return false;
      }
    }

    function loadStateEnhanced() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (raw) {
          const state = JSON.parse(raw);
          showStorageIndicator("âœ… Dados carregados!");
          return state;
        }
        
        const backupRaw = localStorage.getItem(BACKUP_KEY);
        if (backupRaw) {
          const backup = JSON.parse(backupRaw);
          showStorageIndicator("ğŸ”„ Dados restaurados do backup!");
          return backup.data;
        }
        
        return {
          streamers: { "Lince": { pontosAnteriores: 0, atividades: [] } },
          settings: { theme: "dark", autoSave: true, quality: "ultra" },
          stats: { totalSessions: 0, lastAccess: Date.now() }
        };
      } catch (error) {
        console.error("Erro ao carregar dados:", error);
        showStorageIndicator("âŒ Erro ao carregar dados!", true);
        return { streamers: {}, settings: {}, stats: {} };
      }
    }

    function showStorageIndicator(message, isError = false) {
      const indicator = document.getElementById('storageIndicator');
      indicator.textContent = message;
      indicator.style.background = isError ? 
        'linear-gradient(135deg, rgba(255,107,107,.9), rgba(255,71,87,.8))' :
        'linear-gradient(135deg, rgba(139,0,0,.9), rgba(255,69,0,.8))';
      indicator.classList.add('show');
      
      setTimeout(() => {
        indicator.classList.remove('show');
      }, 3000);
    }

    // Sistema de regras
    const REGRAS_PONTOS = {
      tiktok: { video:{pontos:3,limiteDia:1}, stories:{pontos:3,limiteDia:1} },
      kwai: { video:{pontos:3,limiteDia:1}, stories:{pontos:3,limiteDia:1} },
      instagram: { feed:{pontos:3,limiteDia:1}, reels:{pontos:3,limiteDia:1}, stories:{pontos:3,limiteDia:1} },
      youtube: { video:{pontos:3,limiteDia:1}, shorts:{pontos:3,limiteDia:1}, stories:{pontos:3,limiteDia:1}, post:{pontos:3,limiteDia:1} },
      kick: { video:{pontos:3,limiteDia:1} },
      twitch: { raid:{pontos:8,limiteDia:1}, stories:{pontos:3,limiteDia:1} },
      codigo: { indicacao:{pontos:5} }
    };

    function calcularPontosLive(horas) {
      if (typeof horas !== "number" || isNaN(horas)) return 0;
      if (horas < 1) return 0;
      return Math.min(Math.floor(horas), 20);
    }

    function calcularPontosViews(views) {
      if (typeof views !== "number" || isNaN(views)) return 0;
      if (views < 100) return 2;
      if (views >= 3000) return 36;
      if (views >= 2000) return 24;
      if (views >= 1000) return 12;
      if (views >= 800) return 10;
      if (views >= 500) return 8;
      if (views >= 350) return 6;
      if (views >= 100) return 4;
      return 2;
    }

    function normalizarTipo(plataforma, tipo){
      if (plataforma === "kwai" && tipo === "feed") return "video";
      if (plataforma === "youtube" && tipo === "post") return "post";
      return tipo;
    }

    function nomeTipo(plataforma, tipo){
      const t = normalizarTipo(plataforma, tipo);
      const map = {
        video: "VÃ­deo", stories: "Stories", feed: "Postagem no feed",
        reels: "Reels", shorts: "Shorts", raid: "Raid", indicacao: "IndicaÃ§Ã£o", post: "Post"
      };
      return map[t] || tipo;
    }

    function nomePlataforma(p){
      const map = { 
        tiktok:"TikTok", kwai:"Kwai", instagram:"Instagram", 
        youtube:"YouTube", twitch:"Twitch", kick:"Kick", codigo:"CÃ³digo" 
      };
      return map[p] || p;
    }

    // FunÃ§Ãµes de data
    const dateCache = new Map();

    function toDateOnlyISO(d) {
      const key = d.getTime();
      if (dateCache.has(key)) return dateCache.get(key);
      
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth()+1).padStart(2,"0");
      const dd = String(d.getDate()).padStart(2,"0");
      const result = `${yyyy}-${mm}-${dd}`;
      
      dateCache.set(key, result);
      return result;
    }

    function parseISODate(iso) {
      const cacheKey = `parse_${iso}`;
      if (dateCache.has(cacheKey)) return dateCache.get(cacheKey);
      
      const [y,m,d] = iso.split("-").map(Number);
      const result = new Date(y, m-1, d, 12, 0, 0, 0);
      
      dateCache.set(cacheKey, result);
      return result;
    }

    function startOfWeek(d) {
      const x = new Date(d);
      const day = x.getDay();
      const diff = (day === 0 ? -6 : 1 - day);
      x.setDate(x.getDate() + diff);
      x.setHours(12,0,0,0);
      return x;
    }

    function endOfWeek(d) {
      const s = startOfWeek(d);
      const e = new Date(s);
      e.setDate(e.getDate() + 6);
      e.setHours(12,0,0,0);
      return e;
    }

    function startOfMonth(d) { return new Date(d.getFullYear(), d.getMonth(), 1, 12,0,0,0); }
    function endOfMonth(d) { return new Date(d.getFullYear(), d.getMonth()+1, 0, 12,0,0,0); }

    function labelPeriodo(periodo, refDateISO) {
      const d = parseISODate(refDateISO);
      if (periodo === "dia") return refDateISO;
      if (periodo === "semanal") {
        const s = startOfWeek(d), e = endOfWeek(d);
        return `${toDateOnlyISO(s)} a ${toDateOnlyISO(e)}`;
      }
      const s = startOfMonth(d), e = endOfMonth(d);
      return `${toDateOnlyISO(s)} a ${toDateOnlyISO(e)}`;
    }

    function filtrarPorPeriodo(atividades, periodo, refDateISO) {
      const ref = parseISODate(refDateISO);
      let ini, fim;

      if (periodo === "dia") { ini = parseISODate(refDateISO); fim = parseISODate(refDateISO); }
      else if (periodo === "semanal") { ini = startOfWeek(ref); fim = endOfWeek(ref); }
      else { ini = startOfMonth(ref); fim = endOfMonth(ref); }

      const iniISO = toDateOnlyISO(ini);
      const fimISO = toDateOnlyISO(fim);

      return atividades.filter(a => a.data >= iniISO && a.data <= fimISO);
    }

    // Estado principal
    let state = loadStateEnhanced();

    // Cache de cÃ¡lculos
    const calculationCache = new Map();

    function calcularPeriodoStreamer(streamer, periodo, refDateISO){
      const cacheKey = `${streamer}_${periodo}_${refDateISO}_${JSON.stringify(state.streamers[streamer]?.atividades || [])}`;
      if (calculationCache.has(cacheKey)) return calculationCache.get(cacheKey);
      
      const s = state.streamers[streamer];
      if (!s) return { pontosPeriodo: 0, total: 0, auditoria: [] };
      
      const atividadesPeriodo = filtrarPorPeriodo(s.atividades, periodo, refDateISO);

      const controleDiarioConteudo = {};
      const auditoria = [];

      let pontosConteudo = 0;
      let pontosLives = 0;
      let pontosViews = 0;
      let pontosAcoes = 0;

      const gruposConteudo = {};
      const livesDetalhe = [];
      const viewsDetalhe = [];
      const acoesDetalhe = [];

      let conteudosPontuados = 0;

      for (const a of atividadesPeriodo){
        const data = a.data;
        const categoria = a.categoria || "conteudo";
        const plataforma = a.plataforma || "desconhecida";
        const tipoOriginal = a.tipo || "-";
        const tipo = normalizarTipo(plataforma, tipoOriginal);

        if (categoria === "live"){
          const pts = calcularPontosLive(Number(a.horas));
          if (pts > 0){
            pontosLives += pts;
            livesDetalhe.push({ data, plataforma, horas: Number(a.horas), pontos: pts });
            auditoria.push({ id:a.id, data, categoria, plataforma, tipo:"live", status:"Pontuado", pontos:pts });
          } else {
            auditoria.push({ id:a.id, data, categoria, plataforma, tipo:"live", status:"Ignorado (horas < 1)", pontos:0 });
          }
          continue;
        }

        if (categoria === "views"){
          if (tipo === "reels" || tipo === "shorts"){
            auditoria.push({ id:a.id, data, categoria, plataforma, tipo:tipoOriginal, status:"Ignorado (views nÃ£o contam p/ reels/shorts)", pontos:0 });
            continue;
          }
          const pts = calcularPontosViews(Number(a.views));
          if (pts > 0){
            pontosViews += pts;
            viewsDetalhe.push({ data, plataforma, tipo: tipoOriginal, views: Number(a.views), pontos: pts });
            auditoria.push({ id:a.id, data, categoria, plataforma, tipo:tipoOriginal, status:"Pontuado", pontos:pts });
          } else {
            auditoria.push({ id:a.id, data, categoria, plataforma, tipo:tipoOriginal, status:"Ignorado (faixa sem pontos)", pontos:0 });
          }
          continue;
        }

        if (categoria === "raid"){
          const regra = REGRAS_PONTOS.twitch.raid;
          
          // Verificar se jÃ¡ existe um raid nesta data
          const raidExistenteNaData = atividadesPeriodo.some(
            at => at.categoria === "raid" && at.data === data && at.id !== a.id
          );
          
          if (raidExistenteNaData) {
            auditoria.push({ id:a.id, data, categoria, plataforma, tipo:"raid", status:"Ignorado (limite 1 por dia)", pontos:0 });
            continue;
          }
          
          pontosAcoes += regra.pontos;
          acoesDetalhe.push({ data, acao:"Raid", plataforma, pontos: regra.pontos });
          auditoria.push({ id:a.id, data, categoria, plataforma, tipo:"raid", status:"Pontuado", pontos:regra.pontos });
          continue;
        }

        if (categoria === "codigo"){
          const regra = REGRAS_PONTOS.codigo.indicacao;
          const qtd = Number(a.quantidade || 1);
          const pts = regra.pontos * (isNaN(qtd) ? 1 : qtd);
          pontosAcoes += pts;
          acoesDetalhe.push({ data, acao:"IndicaÃ§Ã£o", plataforma:"codigo", pontos: pts });
          auditoria.push({ id:a.id, data, categoria, plataforma:"codigo", tipo:"indicacao", status:"Pontuado", pontos:pts });
          continue;
        }

        const regra = REGRAS_PONTOS[plataforma]?.[tipo];
        if (!regra){
          auditoria.push({ id:a.id, data, categoria, plataforma, tipo:tipoOriginal, status:"Ignorado (sem regra)", pontos:0 });
          continue;
        }

        // Removido limite diÃ¡rio - conta todas as publicaÃ§Ãµes
        pontosConteudo += regra.pontos;
        conteudosPontuados += 1;

        const label = `${nomeTipo(plataforma, tipo)} ${nomePlataforma(plataforma)}`;
        if (!gruposConteudo[label]) gruposConteudo[label] = { count: 0, pontos: 0 };
        gruposConteudo[label].count += 1;
        gruposConteudo[label].pontos += regra.pontos;

        auditoria.push({ id:a.id, data, categoria, plataforma, tipo:tipoOriginal, status:"Pontuado", pontos:regra.pontos });
      }

      const pontosPeriodo = pontosConteudo + pontosLives + pontosViews + pontosAcoes;
      const total = (s.pontosAnteriores || 0) + pontosPeriodo;

      const result = {
        atividadesPeriodo, auditoria,
        pontosConteudo, pontosLives, pontosViews, pontosAcoes,
        pontosPeriodo, total, conteudosPontuados,
        gruposConteudo, livesDetalhe, viewsDetalhe, acoesDetalhe
      };
      
      calculationCache.set(cacheKey, result);
      
      if (calculationCache.size > 100) {
        const firstKey = calculationCache.keys().next().value;
        calculationCache.delete(firstKey);
      }
      
      return result;
    }

    // Parser de texto
    function uuid(){
      return Math.random().toString(16).slice(2) + "-" + Date.now().toString(16);
    }

    function parseBulkInput(text, dataISO) {
      const linhas = text.split("\n").map(l => l.trim()).filter(Boolean);
      const atividades = [];

      // FunÃ§Ã£o para extrair plataforma de URL
      function getPlatformaFromUrl(url) {
        if (!url) return null;
        const urlLower = url.toLowerCase();
        if (urlLower.includes('tiktok.com') || urlLower.includes('vt.tiktok.com')) return 'tiktok';
        if (urlLower.includes('instagram.com')) return 'instagram';
        if (urlLower.includes('youtube.com') || urlLower.includes('youtu.be')) return 'youtube';
        if (urlLower.includes('kwai')) return 'kwai';
        if (urlLower.includes('kick.com')) return 'kick';
        return null;
      }

      // FunÃ§Ã£o para extrair tipo de conteÃºdo de URL
      function getTipoFromUrl(url) {
        if (!url) return 'video';
        const urlLower = url.toLowerCase();
        if (urlLower.includes('/shorts/') || urlLower.includes('youtube.com/shorts')) return 'shorts';
        if (urlLower.includes('/reel/')) return 'reels';
        if (urlLower.includes('/stories/') || urlLower.includes('/stories')) return 'stories';
        if (urlLower.includes('/post/') || urlLower.includes('youtube.com/post')) return 'post';
        if (urlLower.includes('/p/') && urlLower.includes('instagram')) return 'feed';
        return 'video';
      }

      for (let i = 0; i < linhas.length; i++) {
        const linha = linhas[i];
        const l = linha.toLowerCase();

        // Pular cabeÃ§alhos e linhas irrelevantes primeiro
        if (l.match(/^(tiktok|kwai|instagram|youtube|kick|twitch)\s*\(pontos\)$/)) continue;
        if (l.match(/^[a-zA-Z0-9_]+$/)) continue;
        if (l.match(/^\[\d{2}:\d{2}\]/) || l.match(/^\d{2}:\d{2}/)) continue;

        // Extrair URL da linha atual ou prÃ³xima
        let url = null;
        let urlMatch = linha.match(/(https?:\/\/[^\s]+)/);
        if (urlMatch) {
          url = urlMatch[1];
        } else if (i + 1 < linhas.length) {
          // Verificar se prÃ³xima linha Ã© uma URL
          const nextMatch = linhas[i + 1].match(/^(https?:\/\/[^\s]+)/);
          if (nextMatch) {
            url = nextMatch[1];
          }
        }

        // Se Ã© uma URL pura, tentar processar com plataforma da URL
        if (l.match(/^https?:\/\//)) {
          const platform = getPlatformaFromUrl(linha);
          if (platform) {
            const tipo = getTipoFromUrl(linha);
            atividades.push({
              id: uuid(), data: dataISO, categoria: "conteudo",
              plataforma: platform, tipo, url: linha
            });
          }
          continue;
        }

        // FORMATO ESTRUTURADO COM BULLET POINTS (ãƒ») E URLS
        
        // Match: "ãƒ»1 VÃ­deo no TikTok: URL" or "ãƒ»1 VÃ­deo no TikTok"
        let m = l.match(/^[ãƒ»â€¢\-\*]\s*(\d+)\s+(v[Ã­i]deo|video)\s+no\s+(tiktok|tik\s*tok)(?:\s*:.*)?$/);
        if (m) {
          const qtd = Number(m[1]);
          for (let j = 0; j < qtd; j++) {
            atividades.push({
              id: uuid(), data: dataISO, categoria: "conteudo",
              plataforma: "tiktok", tipo: "video", url
            });
          }
          continue;
        }

        // Match: "ãƒ»1 Stories no TikTok" or variations
        m = l.match(/^[ãƒ»â€¢\-\*]\s*(\d+)\s+(story|stories)\s+no\s+(tiktok|tik\s*tok)(?:\s*:.*)?$/);
        if (m) {
          const qtd = Number(m[1]);
          for (let j = 0; j < qtd; j++) {
            atividades.push({
              id: uuid(), data: dataISO, categoria: "conteudo",
              plataforma: "tiktok", tipo: "stories", url
            });
          }
          continue;
        }

        // Kwai VÃ­deo
        m = l.match(/^[ãƒ»â€¢\-\*]\s*(\d+)\s+(v[Ã­i]deo|video)\s+no\s+kwai(?:\s*:.*)?$/);
        if (m) {
          const qtd = Number(m[1]);
          for (let j = 0; j < qtd; j++) {
            atividades.push({
              id: uuid(), data: dataISO, categoria: "conteudo",
              plataforma: "kwai", tipo: "video", url
            });
          }
          continue;
        }

        // Kwai Story
        m = l.match(/^[ãƒ»â€¢\-\*]\s*(\d+)\s+(story|stories)\s+no\s+kwai(?:\s*:.*)?$/);
        if (m) {
          const qtd = Number(m[1]);
          for (let j = 0; j < qtd; j++) {
            atividades.push({
              id: uuid(), data: dataISO, categoria: "conteudo",
              plataforma: "kwai", tipo: "stories", url
            });
          }
          continue;
        }

        // Instagram - Postagem no feed
        m = l.match(/^[ãƒ»â€¢\-\*]\s*(\d+)\s+(postagem|post)\s+no\s+feed\s+no\s+instagram(?:\s*:.*)?$/);
        if (m) {
          const qtd = Number(m[1]);
          for (let j = 0; j < qtd; j++) {
            atividades.push({
              id: uuid(), data: dataISO, categoria: "conteudo",
              plataforma: "instagram", tipo: "feed", url
            });
          }
          continue;
        }

        // Instagram - Reels
        m = l.match(/^[ãƒ»â€¢\-\*]\s*(\d+)\s+(reels?)(?:\s+no\s+)?instagram(?:\s*:.*)?$/);
        if (m) {
          const qtd = Number(m[1]);
          for (let j = 0; j < qtd; j++) {
            atividades.push({
              id: uuid(), data: dataISO, categoria: "conteudo",
              plataforma: "instagram", tipo: "reels", url
            });
          }
          continue;
        }

        // Instagram - Story
        m = l.match(/^[ãƒ»â€¢\-\*]\s*(\d+)\s+(story|stories)(?:\s+no\s+)?instagram(?:\s*:.*)?$/);
        if (m) {
          const qtd = Number(m[1]);
          for (let j = 0; j < qtd; j++) {
            atividades.push({
              id: uuid(), data: dataISO, categoria: "conteudo",
              plataforma: "instagram", tipo: "stories", url
            });
          }
          continue;
        }

        // YouTube - VÃ­deo
        m = l.match(/^[ãƒ»â€¢\-\*]\s*(\d+)\s+(v[Ã­i]deo|video)\s+no\s+youtube(?:\s*:.*)?$/);
        if (m) {
          const qtd = Number(m[1]);
          for (let j = 0; j < qtd; j++) {
            atividades.push({
              id: uuid(), data: dataISO, categoria: "conteudo",
              plataforma: "youtube", tipo: "video", url
            });
          }
          continue;
        }

        // YouTube - Shorts
        m = l.match(/^[ãƒ»â€¢\-\*]\s*(\d+)\s+(shorts?)(?:\s+no\s+)?youtube(?:\s*:.*)?$/);
        if (m) {
          const qtd = Number(m[1]);
          for (let j = 0; j < qtd; j++) {
            atividades.push({
              id: uuid(), data: dataISO, categoria: "conteudo",
              plataforma: "youtube", tipo: "shorts", url
            });
          }
          continue;
        }

        // YouTube - Story/Post
        m = l.match(/^[ãƒ»â€¢\-\*]\s*(\d+)\s+(story|stories|post)(?:\s+no\s+)?youtube(?:\s*:.*)?$/);
        if (m) {
          const qtd = Number(m[1]);
          for (let j = 0; j < qtd; j++) {
            atividades.push({
              id: uuid(), data: dataISO, categoria: "conteudo",
              plataforma: "youtube", tipo: "post", url
            });
          }
          continue;
        }

        // Kick VÃ­deo
        m = l.match(/^[ãƒ»â€¢\-\*]\s*(\d+)\s+(v[Ã­i]deo|video)(?:\s+no\s+)?kick(?:\s*:.*)?$/);
        if (m) {
          const qtd = Number(m[1]);
          for (let j = 0; j < qtd; j++) {
            atividades.push({
              id: uuid(), data: dataISO, categoria: "conteudo",
              plataforma: "kick", tipo: "video", url
            });
          }
          continue;
        }

        // Lives
        m = l.match(/(?:live\s*\d*[:\-]?\s*(\d+(?:\.\d+)?)h|(\d+(?:\.\d+)?)h?\s*live)/);
        if (m) {
          const horas = Number(m[1] || m[2]);
          atividades.push({
            id: uuid(), data: dataISO, categoria: "live",
            plataforma: "twitch", tipo: "live", horas: horas
          });
          continue;
        }

        // Views
        m = l.match(/(?:views?\s*(youtube|tiktok|kwai|instagram|kick)?\s*[:\-]?\s*(\d+)|(\d+)\s*views?\s*(youtube|tiktok|kwai|instagram|kick)?|(youtube|tiktok|kwai|instagram|kick)\s*views?\s*[:\-]?\s*(\d+))/);
        if (m) {
          const views = Number(m[2] || m[3] || m[6]);
          const plataforma = (m[1] || m[4] || m[5] || "youtube").toLowerCase();
          atividades.push({
            id: uuid(), data: dataISO, categoria: "views",
            plataforma: plataforma, tipo: "video", views: views
          });
          continue;
        }

        // Raids
        m = l.match(/(?:raid\s*(twitch)?\s*x?(\d+)?|(\d+)\s*raids?)/);
        if (m) {
          const qtd = Number(m[2] || m[3] || 1);
          for (let j = 0; j < qtd; j++) {
            atividades.push({
              id: uuid(), data: dataISO, categoria: "raid",
              plataforma: "twitch", tipo: "raid"
            });
          }
          continue;
        }

        // IndicaÃ§Ãµes
        m = l.match(/(?:indica[cÃ§][aÃ£]o\s*x?(\d+)|(\d+)\s*indica[cÃ§][Ãµo]es?|referrals?\s*x?(\d+)|(\d+)\s*referrals?)/);
        if (m) {
          const qtd = Number(m[1] || m[2] || m[3] || m[4]);
          atividades.push({
            id: uuid(), data: dataISO, categoria: "codigo",
            plataforma: "codigo", tipo: "indicacao", quantidade: qtd
          });
          continue;
        }

        // Fallback: Generic content matchers (less specific)
        m = l.match(/(?:(\d+)\s*)?(?:v[Ã­i]deo|video)\s+(?:no\s+)?(tiktok|tik\s*tok|kwai|kick)/);
        if (m) {
          const qtd = Number(m[1] || 1);
          const platform = m[2].replace(/\s+/g, '').toLowerCase();
          for (let j = 0; j < qtd; j++) {
            atividades.push({
              id: uuid(), data: dataISO, categoria: "conteudo",
              plataforma: platform, tipo: "video", url
            });
          }
          continue;
        }

        m = l.match(/(?:(\d+)\s*)?(?:story|stories)\s+(?:no\s+)?(tiktok|tik\s*tok|kwai|kick)/);
        if (m) {
          const qtd = Number(m[1] || 1);
          const platform = m[2].replace(/\s+/g, '').toLowerCase();
          for (let j = 0; j < qtd; j++) {
            atividades.push({
              id: uuid(), data: dataISO, categoria: "conteudo",
              plataforma: platform, tipo: "stories", url
            });
          }
          continue;
        }

        m = l.match(/(?:(\d+)\s*)?(?:reels?)\s+(?:no\s+)?instagram/);
        if (m) {
          const qtd = Number(m[1] || 1);
          for (let j = 0; j < qtd; j++) {
            atividades.push({
              id: uuid(), data: dataISO, categoria: "conteudo",
              plataforma: "instagram", tipo: "reels", url
            });
          }
          continue;
        }

        m = l.match(/(?:(\d+)\s*)?(?:shorts?)\s+(?:no\s+)?youtube/);
        if (m) {
          const qtd = Number(m[1] || 1);
          for (let j = 0; j < qtd; j++) {
            atividades.push({
              id: uuid(), data: dataISO, categoria: "conteudo",
              plataforma: "youtube", tipo: "shorts", url
            });
          }
          continue;
        }

        // Parser de mensagens do Discord/WhatsApp
        m = l.match(/(?:\[\d{2}:\d{2}\])?\s*[a-zA-Z0-9_]+\s*:\s*(.+)/);
        if (m) {
          const subAtividades = parseBulkInput(m[1], dataISO);
          atividades.push(...subAtividades);
          continue;
        }
      }

      return atividades;
    }

    // Gerador de mensagem Discord
    function gerarMensagemDiscord(streamer, periodo, refDateISO, r){
      const linhas = [];
      const rewardsText = getRewardsText(r.total);

      linhas.push(`# <a:trofeu1:1432593868439949343> **RelatÃ³rio de PontuaÃ§Ã£o Streamers Atlanta** <a:trofeu1:1432593868439949343> ğŸƒ`);
      linhas.push(`### ğŸ“¦ Pontos por ConteÃºdo e AÃ§Ã£o`);
      
      // Agrupar conteÃºdo por tipo e plataforma de forma clara
      const conteudoDetalhado = {};
      for (const [label, item] of Object.entries(r.gruposConteudo)) {
        if (!conteudoDetalhado[label]) {
          conteudoDetalhado[label] = { count: 0, pontos: 0 };
        }
        conteudoDetalhado[label].count += item.count;
        conteudoDetalhado[label].pontos += item.pontos;
      }

      // Exibir conteÃºdo agrupado
      Object.keys(conteudoDetalhado).sort().forEach((k) => {
        const it = conteudoDetalhado[k];
        linhas.push(`> **${k}** (x${it.count}): ${it.pontos} pontos`);
      });

      // Exibir lives se houver
      if (r.livesDetalhe.length){
        r.livesDetalhe.forEach((l) => {
          const h = (typeof l.horas === "number" && !isNaN(l.horas)) ? l.horas : 0;
          linhas.push(`> **Lives Twitch** (${h}h): ${l.pontos} pontos`);
        });
      }

      // Exibir views se houver
      if (r.viewsDetalhe.length){
        r.viewsDetalhe.forEach((v) => {
          linhas.push(`> **${nomePlataforma(v.plataforma)} Views** (${v.views} views): ${v.pontos} pontos`);
        });
      }

      // Exibir aÃ§Ãµes especiais se houver
      if (r.acoesDetalhe.length){
        r.acoesDetalhe.forEach((a) => {
          linhas.push(`> **${a.acao}**: ${a.pontos} pontos`);
        });
      }

      linhas.push(`### ğŸ“ˆ Resumo`);
      linhas.push(`> **Pontos Deste Ciclo:** \`${r.pontosPeriodo} pontos\``);
      linhas.push(`> **Pontos Anteriores:** \`${state.streamers[streamer]?.pontosAnteriores || 0} pontos\``);
      linhas.push(``);
      linhas.push(`# ğŸª™ PontuaÃ§Ã£o Total Atual: **${r.total} pontos**`);
      linhas.push(`ğŸ–¥ï¸ Total de PublicaÃ§Ãµes no Ciclo: **${r.conteudosPontuados}**`);
      linhas.push(``);

      linhas.push(`---`);
      linhas.push(rewardsText);
      linhas.push(``);

      linhas.push(`*ğŸƒ Powered by Sistema BÃºfalo Atlanta*`);

      return linhas.join("\n");
    }

    // FunÃ§Ãµes de performance
    function calcularDesempenhoIndividual(streamer, mode) {
      const s = state.streamers[streamer];
      if (!s || !s.atividades.length) return [];

      const buckets = new Map();
      
      for (const a of s.atividades) {
        const d = parseISODate(a.data);
        let key;
        
        if (mode === "semanal") {
          const startWeek = startOfWeek(d);
          const endWeek = endOfWeek(d);
          key = `${toDateOnlyISO(startWeek)} a ${toDateOnlyISO(endWeek)}`;
        } else {
          const y = d.getFullYear();
          const m = String(d.getMonth()+1).padStart(2,"0");
          key = `${y}-${m}`;
        }
        
        if (!buckets.has(key)) {
          buckets.set(key, []);
        }
        buckets.get(key).push(a);
      }

      const results = [];
      for (const [periodo, atividades] of buckets) {
        const controleDiarioConteudo = {};
        let pontosConteudo = 0, pontosLives = 0, pontosViews = 0, pontosAcoes = 0;

        for (const a of atividades) {
          const categoria = a.categoria || "conteudo";
          const plataforma = a.plataforma || "desconhecida";
          const tipo = normalizarTipo(plataforma, a.tipo || "-");

          if (categoria === "live") {
            pontosLives += calcularPontosLive(Number(a.horas));
          } else if (categoria === "views") {
            if (tipo !== "reels" && tipo !== "shorts") {
              pontosViews += calcularPontosViews(Number(a.views));
            }
          } else if (categoria === "raid") {
            pontosAcoes += REGRAS_PONTOS.twitch.raid.pontos;
          } else if (categoria === "codigo") {
            const qtd = Number(a.quantidade || 1);
            pontosAcoes += REGRAS_PONTOS.codigo.indicacao.pontos * (isNaN(qtd) ? 1 : qtd);
          } else {
            const regra = REGRAS_PONTOS[plataforma]?.[tipo];
            if (regra) {
              // Removido limite diÃ¡rio - conta todas as publicaÃ§Ãµes
              pontosConteudo += regra.pontos;
            }
          }
        }

        const pontosPeriodo = pontosConteudo + pontosLives + pontosViews + pontosAcoes;
        results.push({
          periodo, pontosPeriodo, pontosConteudo,
          pontosLives, pontosViews, pontosAcoes,
          atividades: atividades.length
        });
      }

      results.sort((a, b) => a.periodo.localeCompare(b.periodo));
      return results;
    }

    function formatDesempenhoText(results, titulo, streamer) {
      const lines = [];
      lines.push(`# ğŸ“Š DESEMPENHO ${titulo.toUpperCase()} â€” ${streamer.toUpperCase()} ğŸƒ`);
      lines.push(`*EvoluÃ§Ã£o do streamer na arena Atlanta*`);
      lines.push(``);
      
      if (!results.length) {
        lines.push(`*ğŸƒ Ainda nÃ£o hÃ¡ dados de performance para este perÃ­odo...*`);
        return lines.join("\n");
      }

      const totalPontos = results.reduce((sum, r) => sum + r.pontosPeriodo, 0);
      const mediaPontos = Math.round(totalPontos / results.length);
      const melhorPeriodo = results.reduce((max, r) => r.pontosPeriodo > max.pontosPeriodo ? r : max);
      
      lines.push(`### ğŸ† **ESTATÃSTICAS GERAIS**`);
      lines.push(`> **Total de Pontos:** ${totalPontos} pts`);
      lines.push(`> **MÃ©dia por PerÃ­odo:** ${mediaPontos} pts`);
      lines.push(`> **Melhor PerÃ­odo:** ${melhorPeriodo.periodo} (${melhorPeriodo.pontosPeriodo} pts)`);
      lines.push(``);

      lines.push(`### ğŸ“ˆ **HISTÃ“RICO DETALHADO**`);
      results.forEach((r, idx) => {
        const trend = idx > 0 ? 
          (r.pontosPeriodo > results[idx-1].pontosPeriodo ? "ğŸ“ˆ" : 
           r.pontosPeriodo < results[idx-1].pontosPeriodo ? "ğŸ“‰" : "â¡ï¸") : "ğŸ¯";
        
        lines.push(`**${r.periodo}** ${trend}`);
        lines.push(`> ğŸ¯ **Total:** ${r.pontosPeriodo} pts | ğŸ“¦ ConteÃºdo: ${r.pontosConteudo} | ğŸ”´ Lives: ${r.pontosLives} | ğŸ‘ï¸ Views: ${r.pontosViews} | âš¡ AÃ§Ãµes: ${r.pontosAcoes}`);
        lines.push(`> ğŸ“Š **Atividades:** ${r.atividades} registradas`);
        lines.push(``);
      });
      
      return lines.join("\n");
    }

    // Sistema de partÃ­culas
    function createParticles() {
      const container = document.getElementById('particles');
      const particleCount = 20;
      
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.animationDelay = Math.random() * 8 + 's';
        particle.style.animationDuration = (8 + Math.random() * 4) + 's';
        container.appendChild(particle);
      }
    }

    // FunÃ§Ãµes de UI
    const $ = (id) => document.getElementById(id);

    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }

    function refreshStreamerSelect(){
      const sel = $("streamerSelect");
      sel.innerHTML = "";
      const names = Object.keys(state.streamers).sort();
      for (const n of names){
        const opt = document.createElement("option");
        opt.value = n;
        opt.textContent = n;
        sel.appendChild(opt);
      }
      if (!names.length){
        state.streamers["Streamer 1"] = { pontosAnteriores: 0, atividades: [] };
        saveStateEnhanced(state);
        return refreshStreamerSelect();
      }
    }

    function currentStreamer(){
      return $("streamerSelect").value;
    }

    const debouncedRender = debounce(function render(){
      const streamer = currentStreamer();
      const periodo = $("periodo").value;
      const refDateISO = $("refDate").value;

      $("pillPeriodo").textContent = labelPeriodo(periodo, refDateISO);
      $("pontosAnteriores").value = state.streamers[streamer]?.pontosAnteriores || 0;
      
      // Sincronizar campo de data do raid com a data de referÃªncia
      $("manualRaidDate").value = refDateISO;

      const r = calcularPeriodoStreamer(streamer, periodo, refDateISO);

      $("kPontosPeriodo").textContent = r.pontosPeriodo;
      $("kTotal").textContent = r.total;
      $("kConteudo").textContent = r.pontosConteudo;
      $("kLives").textContent = r.pontosLives;
      $("kViews").textContent = r.pontosViews;
      $("kAcoes").textContent = r.pontosAcoes;

      const tb = $("auditBody");
      tb.innerHTML = "";
      
      const fragment = document.createDocumentFragment();
      
      for (const row of r.auditoria){
        const tr = document.createElement("tr");
        const ok = row.status === "Pontuado";
        tr.innerHTML = `
          <td class="mono">
            <input type="checkbox" data-id="${row.id}" style="transform:scale(1.2); margin-right:10px; vertical-align:middle;">
            ${row.data}
          </td>
          <td>${row.categoria}</td>
          <td>${nomePlataforma(row.plataforma)}</td>
          <td>${row.tipo}</td>
          <td class="${ok ? "tag-ok" : "tag-no"}">${row.status}</td>
          <td><strong>${row.pontos}</strong></td>
        `;
        fragment.appendChild(tr);
      }
      
      tb.appendChild(fragment);
    }, 100);

    // Event handlers
    $("addStreamerBtn").addEventListener("click", () => {
      const name = $("newStreamer").value.trim();
      if (!name) return;
      if (state.streamers[name]) {
        showStorageIndicator("âš ï¸ Streamer jÃ¡ existe!", true);
        return;
      }
      state.streamers[name] = { pontosAnteriores: 0, atividades: [] };
      saveStateEnhanced(state);
      $("newStreamer").value = "";
      refreshStreamerSelect();
      $("streamerSelect").value = name;
      debouncedRender();
      showStorageIndicator(`ğŸ›¡ï¸ Streamer ${name} adicionado!`);
      calculationCache.clear();
    });

    $("removeStreamerBtn").addEventListener("click", () => {
      const name = currentStreamer();
      if (!name) return;
      if (confirm(`ğŸ—¡ï¸ Tem certeza que deseja remover o streamer ${name} da arena?`)) {
        delete state.streamers[name];
        saveStateEnhanced(state);
        refreshStreamerSelect();
        debouncedRender();
        showStorageIndicator(`âš”ï¸ Streamer ${name} removido!`);
        calculationCache.clear();
      }
    });

    $("updatePontosBtn").addEventListener("click", () => {
      const streamer = currentStreamer();
      const pontos = parseInt($("pontosAnteriores").value) || 0;
      
      if (!state.streamers[streamer]) return;
      
      state.streamers[streamer].pontosAnteriores = pontos;
      saveStateEnhanced(state);
      debouncedRender();
      showStorageIndicator(`ğŸ’ Pontos anteriores atualizados: ${pontos}`);
      calculationCache.clear();
    });

    $("addManualLiveBtn").addEventListener("click", () => {
      const streamer = currentStreamer();
      const horas = parseFloat($("manualLiveHours").value);
      const plataforma = $("manualPlatform").value;
      const dataISO = $("refDate").value;
      
      if (!horas || horas <= 0) {
        showStorageIndicator("âš ï¸ Insira as horas da live!", true);
        return;
      }
      
      const novaAtividade = {
        id: uuid(), data: dataISO, categoria: "live",
        plataforma: plataforma, tipo: "live", horas: horas
      };
      
      state.streamers[streamer].atividades.push(novaAtividade);
      saveStateEnhanced(state);
      $("manualLiveHours").value = "";
      debouncedRender();
      showStorageIndicator(`ğŸ”´ Live adicionada: ${horas}h`);
      calculationCache.clear();
    });

    $("addManualViewsBtn").addEventListener("click", () => {
      const streamer = currentStreamer();
      const views = parseInt($("manualViews").value);
      const plataforma = $("manualPlatform").value;
      const dataISO = $("refDate").value;
      
      if (!views || views <= 0) {
        showStorageIndicator("âš ï¸ Insira o nÃºmero de views!", true);
        return;
      }
      
      const novaAtividade = {
        id: uuid(), data: dataISO, categoria: "views",
        plataforma: plataforma, tipo: "video", views: views
      };
      
      state.streamers[streamer].atividades.push(novaAtividade);
      saveStateEnhanced(state);
      $("manualViews").value = "";
      debouncedRender();
      showStorageIndicator(`ğŸ‘ï¸ Views adicionadas: ${views}`);
      calculationCache.clear();
    });

    $("addManualRaidBtn").addEventListener("click", () => {
      const streamer = currentStreamer();
      const dataRaid = $("manualRaidDate").value;
      
      if (!dataRaid) {
        showStorageIndicator("âš ï¸ Selecione a data do RAID!", true);
        return;
      }
      
      // Verificar se jÃ¡ existe um raid nesta data
      const raidExistente = state.streamers[streamer].atividades.some(
        a => a.categoria === "raid" && a.data === dataRaid
      );
      
      if (raidExistente) {
        showStorageIndicator("âš ï¸ JÃ¡ existe um RAID registrado nesta data! (Limite: 1 por dia)", true);
        return;
      }
      
      const novaAtividade = {
        id: uuid(), data: dataRaid, categoria: "raid",
        plataforma: "twitch", tipo: "raid"
      };
      
      state.streamers[streamer].atividades.push(novaAtividade);
      saveStateEnhanced(state);
      $("manualRaidDate").value = "";
      debouncedRender();
      showStorageIndicator(`âš¡ RAID adicionado: ${dataRaid} (8 pontos)`);
      calculationCache.clear();
    });

    $("streamerSelect").addEventListener("change", debouncedRender);
    $("periodo").addEventListener("change", debouncedRender);
    $("refDate").addEventListener("change", debouncedRender);

    $("processBulkBtn").addEventListener("click", () => {
      const streamer = currentStreamer();
      const texto = $("bulkInput").value;
      const dataISO = $("refDate").value;
      if (!texto.trim()) {
        showStorageIndicator("âš ï¸ Cole os dados primeiro!", true);
        return;
      }
      
      const novasAtividades = parseBulkInput(texto, dataISO);
      
      let debugText = `ğŸ” ANÃLISE DO PARSING (${novasAtividades.length} atividades reconhecidas):\n\n`;
      
      if (novasAtividades.length === 0) {
        debugText += "âŒ NENHUMA ATIVIDADE RECONHECIDA!\n\n";
        debugText += "ğŸ“ LINHAS ANALISADAS:\n";
        const linhas = texto.split("\n").map(l => l.trim()).filter(Boolean);
        linhas.forEach((linha, idx) => {
          debugText += `${idx + 1}. "${linha}"\n`;
        });
        debugText += "\nğŸ’¡ DICA: Verifique se o formato estÃ¡ correto. Exemplos:\n";
        debugText += "â€¢ 1 vÃ­deo tik tok\nâ€¢ 1 story Instagram\nâ€¢ live 1: 4h\nâ€¢ views youtube: 1200\n";
      } else {
        const grupos = {};
        novasAtividades.forEach(a => {
          const key = `${a.categoria}-${a.plataforma}-${a.tipo}`;
          if (!grupos[key]) grupos[key] = [];
          grupos[key].push(a);
        });
        
        Object.keys(grupos).forEach(key => {
          const ativs = grupos[key];
          const [categoria, plataforma, tipo] = key.split('-');
          debugText += `âœ… ${categoria.toUpperCase()}: ${nomePlataforma(plataforma)} - ${nomeTipo(plataforma, tipo)} (${ativs.length}x)\n`;
          
          if (categoria === 'live') {
            ativs.forEach(a => debugText += `   â”” ${a.horas}h\n`);
          } else if (categoria === 'views') {
            ativs.forEach(a => debugText += `   â”” ${a.views} views\n`);
          } else if (categoria === 'codigo') {
            ativs.forEach(a => debugText += `   â”” x${a.quantidade || 1}\n`);
          }
        });
      }
      
      $("debugOutput").value = debugText;
      
      if (novasAtividades.length === 0) {
        showStorageIndicator("âš ï¸ Nenhuma atividade reconhecida!", true);
        return;
      }
      
      state.streamers[streamer].atividades.push(...novasAtividades);
      saveStateEnhanced(state);
      $("bulkInput").value = "";
      debouncedRender();
      showStorageIndicator(`âš¡ ${novasAtividades.length} atividades processadas!`);
      calculationCache.clear();
    });

    $("importJsonBtn").addEventListener("click", () => {
      const streamer = currentStreamer();
      const texto = $("bulkInput").value;
      
      if (!texto.trim()) {
        showStorageIndicator("âš ï¸ Cole os dados JSON primeiro!", true);
        return;
      }
      
      try {
        let jsonData;
        
        if (texto.trim().startsWith('{') || texto.trim().startsWith('[')) {
          jsonData = JSON.parse(texto);
        } else {
          showStorageIndicator("âš ï¸ Formato JSON invÃ¡lido!", true);
          return;
        }
        
        let novasAtividades = [];
        
        if (jsonData.atividades && Array.isArray(jsonData.atividades)) {
          novasAtividades = jsonData.atividades.map(a => ({
            id: uuid(),
            data: a.data || $("refDate").value,
            categoria: a.categoria || "conteudo",
            plataforma: a.plataforma || "desconhecida",
            tipo: a.tipo || "video",
            horas: a.horas,
            views: a.views,
            quantidade: a.quantidade,
            url: a.url
          }));
        } else if (Array.isArray(jsonData)) {
          novasAtividades = jsonData.map(a => ({
            id: uuid(),
            data: a.data || $("refDate").value,
            categoria: a.categoria || "conteudo",
            plataforma: a.plataforma || "desconhecida",
            tipo: a.tipo || "video",
            horas: a.horas,
            views: a.views,
            quantidade: a.quantidade,
            url: a.url
          }));
        }
        
        let debugText = `ğŸ“¥ IMPORTAÃ‡ÃƒO JSON (${novasAtividades.length} atividades importadas):\n\n`;
        
        if (novasAtividades.length === 0) {
          debugText += "âŒ NENHUMA ATIVIDADE ENCONTRADA NO JSON!\n\n";
          debugText += "ğŸ’¡ FORMATO ESPERADO:\n";
          debugText += '{\n  "atividades": [\n    {\n      "data": "2026-01-15",\n      "categoria": "conteudo",\n      "plataforma": "tiktok",\n      "tipo": "stories"\n    }\n  ]\n}';
        } else {
          const grupos = {};
          novasAtividades.forEach(a => {
            const key = `${a.categoria}-${a.plataforma}-${a.tipo}`;
            if (!grupos[key]) grupos[key] = [];
            grupos[key].push(a);
          });
          
          Object.keys(grupos).forEach(key => {
            const ativs = grupos[key];
            const [categoria, plataforma, tipo] = key.split('-');
            debugText += `âœ… ${categoria.toUpperCase()}: ${nomePlataforma(plataforma)} - ${nomeTipo(plataforma, tipo)} (${ativs.length}x)\n`;
            
            if (categoria === 'live') {
              ativs.forEach(a => debugText += `   â”” ${a.horas}h\n`);
            } else if (categoria === 'views') {
              ativs.forEach(a => debugText += `   â”” ${a.views} views\n`);
            } else if (categoria === 'codigo') {
              ativs.forEach(a => debugText += `   â”” x${a.quantidade || 1}\n`);
            }
          });
        }
        
        $("debugOutput").value = debugText;
        
        if (novasAtividades.length === 0) {
          showStorageIndicator("âš ï¸ Nenhuma atividade encontrada no JSON!", true);
          return;
        }
        
        state.streamers[streamer].atividades.push(...novasAtividades);
        saveStateEnhanced(state);
        $("bulkInput").value = "";
        debouncedRender();
        showStorageIndicator(`ğŸ“¥ ${novasAtividades.length} atividades importadas do JSON!`);
        calculationCache.clear();
        
      } catch (error) {
        showStorageIndicator("âŒ Erro ao processar JSON: " + error.message, true);
        $("debugOutput").value = `âŒ ERRO NO JSON:\n\n${error.message}\n\nğŸ’¡ VERIFIQUE:\nâ€¢ VÃ­rgulas e chaves corretas\nâ€¢ Aspas duplas nos textos\nâ€¢ Estrutura vÃ¡lida do JSON`;
      }
    });

    $("generateMsgBtn").addEventListener("click", () => {
      const streamer = currentStreamer();
      const periodo = $("periodo").value;
      const refDateISO = $("refDate").value;
      const r = calcularPeriodoStreamer(streamer, periodo, refDateISO);
      $("msgOut").value = gerarMensagemDiscord(streamer, periodo, refDateISO, r);
      showStorageIndicator("ğŸ”¥ Mensagem Ã©pica gerada!");
    });

    $("copyMsgBtn").addEventListener("click", async () => {
      const text = $("msgOut").value;
      if (!text) {
        showStorageIndicator("âš ï¸ Gere a mensagem primeiro!", true);
        return;
      }
      try { 
        await navigator.clipboard.writeText(text);
        showStorageIndicator("ğŸ“‹ Mensagem copiada!");
      } catch {
        showStorageIndicator("âŒ Erro ao copiar!", true);
      }
    });

    $("removeSelectedBtn").addEventListener("click", () => {
      const streamer = currentStreamer();
      const checks = Array.from(document.querySelectorAll("#auditBody input[type='checkbox']:checked"));
      if (checks.length === 0) {
        showStorageIndicator("âš ï¸ Selecione itens primeiro!", true);
        return;
      }
      
      if (confirm(`ğŸ—‘ï¸ Remover ${checks.length} item(s) selecionado(s)?`)) {
        const ids = new Set(checks.map(c => c.getAttribute("data-id")));
        state.streamers[streamer].atividades = state.streamers[streamer].atividades.filter(a => !ids.has(a.id));
        saveStateEnhanced(state);
        debouncedRender();
        showStorageIndicator(`ğŸ—‘ï¸ ${checks.length} item(s) removido(s)!`);
        calculationCache.clear();
      }
    });

    $("clearAllStreamerBtn").addEventListener("click", () => {
      const streamer = currentStreamer();
      if (confirm(`ğŸ’¥ ATENÃ‡ÃƒO! Isso vai limpar TODOS os dados do streamer ${streamer}. Continuar?`)) {
        state.streamers[streamer].atividades = [];
        saveStateEnhanced(state);
        debouncedRender();
        showStorageIndicator(`ğŸ’¥ Dados do streamer ${streamer} limpos!`);
        calculationCache.clear();
      }
    });

    $("showWeeklyPerformanceBtn").addEventListener("click", () => {
      const streamer = currentStreamer();
      const results = calcularDesempenhoIndividual(streamer, "semanal");
      $("performanceOut").value = formatDesempenhoText(results, "Semanal", streamer);
      showStorageIndicator("ğŸ“Š Desempenho semanal carregado!");
    });

    $("showMonthlyPerformanceBtn").addEventListener("click", () => {
      const streamer = currentStreamer();
      const results = calcularDesempenhoIndividual(streamer, "mensal");
      $("performanceOut").value = formatDesempenhoText(results, "Mensal", streamer);
      showStorageIndicator("ğŸ“ˆ Desempenho mensal carregado!");
    });

    // InicializaÃ§Ã£o
    document.addEventListener('DOMContentLoaded', function() {
      createParticles();
      
      refreshStreamerSelect();
      if (Object.keys(state.streamers).length > 0) {
        $("streamerSelect").value = Object.keys(state.streamers).sort()[0];
      }
      debouncedRender();
      
      if (!state.stats) state.stats = {};
      state.stats.totalSessions = (state.stats.totalSessions || 0) + 1;
      state.stats.lastAccess = Date.now();
      saveStateEnhanced(state);
      
      showStorageIndicator("ğŸƒ Sistema Atlanta carregado!");
    });
  </script>
</body>
</html>
