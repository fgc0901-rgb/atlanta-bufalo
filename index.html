<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Agente de Pontua√ß√£o ‚Äî Streamers Atlanta</title>
  <style>
    :root{
      --bg:#0a0a0a;
      --card:#1a1a2e;
      --text:#e8ecff;
      --muted:#aab2d5;
      --ok:#48d597;
      --bad:#ff6b6b;
      --accent:#7c5cff;
      --border: rgba(255,255,255,.15);
      --chip: rgba(255,255,255,.08);
      --buffalo-red: #8b0000;
      --buffalo-orange: #ff4500;
      --buffalo-gold: #ffd700;
    }
    
    *{ box-sizing:border-box; }
    
    body{
      margin:0;
      font-family: 'Segoe UI', system-ui, -apple-system, Arial, sans-serif;
      color:var(--text);
      background: 
        linear-gradient(135deg, rgba(5,5,10,.99) 0%, rgba(15,15,25,.97) 30%, rgba(20,20,40,.95) 50%, rgba(15,15,25,.97) 70%, rgba(5,5,10,.99) 100%),
        radial-gradient(ellipse 1500px 1000px at 10% 20%, rgba(139,0,0,.25) 0%, transparent 50%),
        radial-gradient(ellipse 1200px 900px at 90% 80%, rgba(255,69,0,.2) 0%, transparent 50%),
        radial-gradient(circle at 50% 50%, rgba(139,0,0,.1) 0%, transparent 70%),
        var(--bg);
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }

    .buffalo-hero {
      position: fixed;
      top: 0;
      right: -200px;
      width: 800px;
      height: 100vh;
      background: url('https://cdnb.artstation.com/p/assets/images/images/046/242/845/large/lucas-sant-ana-tatonka.jpg?1648488053') center/cover no-repeat;
      opacity: 0.45;
      z-index: -2;
      will-change: transform, opacity, filter;
      transform: translateZ(0);
      backface-visibility: hidden;
      filter: 
        contrast(2.2) 
        brightness(0.5) 
        sepia(1.2) 
        hue-rotate(310deg) 
        saturate(2.5)
        drop-shadow(0 0 40px rgba(139,0,0,.8))
        drop-shadow(0 0 80px rgba(255,69,0,.6));
      animation: breathe-enhanced 8s ease-in-out infinite;
    }

    .buffalo-hero::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        linear-gradient(90deg, rgba(10,10,10,.95) 0%, rgba(10,10,10,.5) 30%, transparent 65%),
        radial-gradient(ellipse 800px 600px at 100% 40%, rgba(139,0,0,.5) 0%, rgba(139,0,0,.2) 30%, transparent 70%),
        radial-gradient(ellipse 500px 500px at 120% 50%, rgba(255,69,0,.3) 0%, transparent 60%),
        radial-gradient(ellipse 600px 400px at 80% 60%, rgba(255,107,107,.15) 0%, transparent 50%);
      z-index: 1;
      animation: gradient-shift 15s ease-in-out infinite;
    }

    .buffalo-skull {
      position: fixed;
      top: 80px;
      right: 100px;
      width: 300px;
      height: 300px;
      background: url('https://wallpapers.com/images/high/buffalo-skull-art-1d68pwdvaojagn6y.jpg') center/contain no-repeat;
      opacity: 0.25;
      z-index: -1;
      will-change: transform, filter;
      transform: translateZ(0);
      backface-visibility: hidden;
      filter: 
        contrast(2.5) 
        brightness(0.4) 
        sepia(1.2) 
        hue-rotate(310deg) 
        saturate(2)
        drop-shadow(0 0 25px rgba(139,0,0,.6))
        drop-shadow(0 0 50px rgba(255,69,0,.4));
      animation: float-enhanced 20s ease-in-out infinite;
    }

    .particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -1;
      will-change: transform;
      transform: translateZ(0);
      background: 
        radial-gradient(ellipse 1000px 800px at 85% 30%, rgba(139,0,0,.15) 0%, transparent 50%),
        radial-gradient(ellipse 800px 600px at 100% 50%, rgba(255,69,0,.1) 0%, transparent 60%);
      animation: particles-glow 8s ease-in-out infinite;
    }

    .particle {
      position: absolute;
      border-radius: 50%;
      will-change: transform, opacity, box-shadow;
      transform: translateZ(0);
      width: 4px;
      height: 4px;
      background: radial-gradient(circle, rgba(255,69,0,.9), rgba(139,0,0,.6));
      box-shadow: 
        0 0 8px rgba(255,69,0,.8),
        0 0 16px rgba(139,0,0,.5);
      animation: particle-float-enhanced 12s linear infinite;
    }

    @keyframes particles-glow {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 0.6; }
    }

    @keyframes breathe-enhanced {
      0%, 100% { transform: scale(1) translateX(0) translateZ(0); opacity: 0.45; filter: contrast(2.2) brightness(0.5) sepia(1.2) hue-rotate(310deg) saturate(2.5) drop-shadow(0 0 40px rgba(139,0,0,.8)) drop-shadow(0 0 80px rgba(255,69,0,.6)); }
      25% { transform: scale(1.05) translateX(-20px) translateZ(0); opacity: 0.55; filter: contrast(2.4) brightness(0.6) sepia(1.3) hue-rotate(300deg) saturate(2.7) drop-shadow(0 0 50px rgba(139,0,0,.9)) drop-shadow(0 0 100px rgba(255,69,0,.7)); }
      50% { transform: scale(1.1) translateX(-40px) translateZ(0); opacity: 0.65; filter: contrast(2.5) brightness(0.7) sepia(1.4) hue-rotate(290deg) saturate(2.9) drop-shadow(0 0 60px rgba(139,0,0,1)) drop-shadow(0 0 120px rgba(255,69,0,.8)); }
      75% { transform: scale(1.05) translateX(-20px) translateZ(0); opacity: 0.55; filter: contrast(2.4) brightness(0.6) sepia(1.3) hue-rotate(300deg) saturate(2.7) drop-shadow(0 0 50px rgba(139,0,0,.9)) drop-shadow(0 0 100px rgba(255,69,0,.7)); }
    }

    @keyframes gradient-shift {
      0%, 100% { opacity: 0.7; }
      50% { opacity: 1; }
    }

    @keyframes float-enhanced {
      0%, 100% { transform: translateY(0) rotate(0deg) scale(1) translateZ(0); }
      25% { transform: translateY(-30px) rotate(5deg) scale(1.02) translateZ(0); }
      50% { transform: translateY(-60px) rotate(10deg) scale(1.05) translateZ(0); }
      75% { transform: translateY(-30px) rotate(5deg) scale(1.02) translateZ(0); }
    }

    @keyframes particle-float-enhanced {
      0% { 
        transform: translateY(100vh) translateX(0) scale(0) translateZ(0);
        opacity: 0;
      }
      5% {
        opacity: 1;
        transform: scale(1) translateZ(0);
      }
      10% {
        opacity: 1;
        transform: translateY(-80vh) translateX(40px) scale(1.2) translateZ(0);
      }
      50% {
        opacity: 1;
        transform: translateY(-50vh) translateX(80px) scale(1) rotate(180deg) translateZ(0);
      }
      90% {
        opacity: 1;
        transform: translateY(-20vh) translateX(120px) scale(0.8) rotate(360deg) translateZ(0);
      }
      100% { 
        transform: translateY(-100px) translateX(150px) scale(0) rotate(360deg) translateZ(0);
        opacity: 0;
      }
    }

    .wrap{
      max-width: 1400px;
      margin: 0 auto;
      padding: 15px 10px 35px;
      position: relative;
      z-index: 1;
      will-change: transform;
      transform: translateZ(0);
      background: 
        radial-gradient(ellipse 100% 100% at 0% 0%, rgba(26,26,46,.1) 0%, rgba(10,10,10,.3) 50%, rgba(5,5,10,.5) 100%);
      box-shadow: 
        inset 0 0 200px rgba(10,10,10,.4),
        inset -200px 0 300px rgba(139,0,0,.15);
    }

    .header {
      text-align: center;
      margin-bottom: 15px;
      position: relative;
    }

    .header::before {
      content: '';
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      width: 200px;
      height: 4px;
      background: linear-gradient(90deg, transparent, var(--buffalo-red), var(--buffalo-orange), var(--buffalo-red), transparent);
      border-radius: 2px;
      will-change: box-shadow;
      box-shadow: 0 0 20px rgba(139,0,0,.5);
    }

    h1{
      margin: 10px 0 10px;
      font-size: 32px;
      font-weight: 900;
      letter-spacing: 1px;
      text-transform: uppercase;
      background: linear-gradient(135deg, var(--buffalo-gold), var(--buffalo-orange), var(--buffalo-red));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      position: relative;
      will-change: transform;
      text-shadow: 0 0 30px rgba(139,0,0,.3);
    }

    h1::after {
      content: 'üêÉ';
      position: absolute;
      right: -50px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 40px;
      will-change: transform;
      filter: drop-shadow(0 0 15px rgba(255,69,0,.8));
      animation: pulse 4s ease-in-out infinite;
    }

    .sub{
      margin: 0 auto 15px;
      color: var(--muted);
      line-height: 1.6;
      max-width: 800px;
      font-size: 16px;
      text-shadow: 0 0 10px rgba(0,0,0,.8);
    }

    .grid{
      display: grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 12px;
    }

    .card{
      background: 
        linear-gradient(135deg, rgba(26,26,46,.95) 0%, rgba(20,20,40,.98) 100%);
      border: 2px solid transparent;
      background-clip: padding-box;
      border-radius: 20px;
      padding: 14px;
      backdrop-filter: blur(20px);
      position: relative;
      box-shadow: 
        0 15px 35px rgba(0,0,0,.4),
        inset 0 1px 0 rgba(255,255,255,.1),
        0 0 0 1px rgba(139,0,0,.2);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      will-change: transform;
      transform: translateZ(0);
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(circle at 20% 20%, rgba(139,0,0,.08) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(255,69,0,.05) 0%, transparent 50%);
      border-radius: 20px;
      pointer-events: none;
      z-index: -1;
    }

    .card:hover {
      transform: translateY(-5px) translateZ(0);
      box-shadow: 
        0 25px 50px rgba(0,0,0,.5),
        inset 0 1px 0 rgba(255,255,255,.15),
        0 0 0 2px rgba(139,0,0,.4),
        0 0 30px rgba(139,0,0,.2);
    }

    .card h2{
      margin: 0 0 8px;
      font-size: 17px;
      font-weight: 900;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--buffalo-orange);
      position: relative;
      text-shadow: 0 0 10px rgba(255,69,0,.3);
    }

    .card h2::after {
      content: '';
      position: absolute;
      bottom: -5px;
      left: 0;
      width: 60px;
      height: 2px;
      background: linear-gradient(90deg, var(--buffalo-red), var(--buffalo-orange));
      border-radius: 1px;
    }

    label{
      display: block;
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 5px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    input, select, textarea, button{
      width: 100%;
      background: 
        linear-gradient(135deg, rgba(255,255,255,.12) 0%, rgba(255,255,255,.08) 100%);
      border: 2px solid rgba(139,0,0,.4);
      color: var(--text);
      padding: 12px;
      border-radius: 12px;
      outline: none;
      font: inherit;
      font-size: 14px;
      transition: all 0.3s ease;
      box-shadow: inset 0 2px 4px rgba(0,0,0,.3);
      will-change: transform, border-color, box-shadow;
    }

    select {
      background: 
        linear-gradient(135deg, rgba(255,255,255,.15) 0%, rgba(255,255,255,.1) 100%);
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23ff4500' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 12px center;
      background-size: 16px;
      padding-right: 40px;
    }

    select option {
      background: rgba(26,26,46,.98);
      color: var(--text);
      padding: 12px 15px;
      border: none;
      font-size: 14px;
      font-weight: 500;
    }

    select option:hover,
    select option:focus,
    select option:checked {
      background: linear-gradient(135deg, rgba(255,69,0,.3) 0%, rgba(139,0,0,.2) 100%);
      color: var(--buffalo-gold);
    }

    input:focus, select:focus, textarea:focus {
      border-color: var(--buffalo-orange);
      transform: translateY(-2px);
      box-shadow: 
        inset 0 2px 4px rgba(0,0,0,.3),
        0 0 0 3px rgba(255,69,0,.2),
        0 0 20px rgba(255,69,0,.3);
    }

    textarea{ 
      min-height: 180px; 
      resize: vertical; 
      font-family: 'Courier New', monospace;
    }

    button{
      cursor: pointer;
      border: 2px solid var(--buffalo-orange);
      background: 
        linear-gradient(135deg, rgba(255,69,0,.3) 0%, rgba(139,0,0,.2) 100%);
      font-weight: 900;
      text-transform: uppercase;
      letter-spacing: 1px;
      position: relative;
      overflow: hidden;
      will-change: transform, border-color, background;
    }

    button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.2), transparent);
      transition: left 0.6s ease;
      will-change: left;
    }

    button:hover::before {
      left: 100%;
    }

    button:hover {
      border-color: var(--buffalo-gold);
      background: 
        linear-gradient(135deg, rgba(255,215,0,.4) 0%, rgba(255,69,0,.3) 100%);
      transform: translateY(-3px);
      box-shadow: 
        0 8px 25px rgba(255,69,0,.3),
        0 0 30px rgba(255,215,0,.2);
      animation: button-pulse 1.5s ease-in-out infinite;
    }

    button.secondary{
      border: 2px solid rgba(255,255,255,.3);
      background: 
        linear-gradient(135deg, rgba(255,255,255,.1) 0%, rgba(255,255,255,.05) 100%);
    }

    button.secondary:hover {
      border-color: var(--buffalo-orange);
      background: 
        linear-gradient(135deg, rgba(255,69,0,.2) 0%, rgba(255,255,255,.1) 100%);
    }

    button.danger{
      border: 2px solid #ff6b6b;
      background: 
        linear-gradient(135deg, rgba(255,107,107,.3) 0%, rgba(255,107,107,.15) 100%);
    }

    button.danger:hover {
      border-color: #ff4757;
      background: 
        linear-gradient(135deg, rgba(255,71,87,.4) 0%, rgba(255,107,107,.25) 100%);
      box-shadow: 
        0 8px 25px rgba(255,107,107,.3),
        0 0 30px rgba(255,71,87,.2);
    }

    .row{ display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 8px; }
    .row-3{ display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 8px; }
    .span4{ grid-column: span 4; }
    .span6{ grid-column: span 6; }
    .span8{ grid-column: span 8; }
    .span12{ grid-column: span 12; }

    .pill{
      display: inline-flex; 
      align-items: center; 
      gap: 6px;
      padding: 6px 12px; 
      border-radius: 25px; 
      border: 2px solid rgba(139,0,0,.4);
      background: 
        linear-gradient(135deg, rgba(139,0,0,.15) 0%, rgba(255,69,0,.1) 100%);
      color: var(--buffalo-orange); 
      font-size: 13px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      box-shadow: 
        0 4px 15px rgba(0,0,0,.2),
        inset 0 1px 0 rgba(255,255,255,.1);
    }

    .kpis{ 
      display: flex; 
      gap: 12px; 
      flex-wrap: wrap; 
      margin: 10px 0;
    }

    .kpi{
      flex: 1 1 200px;
      background: 
        linear-gradient(135deg, rgba(255,255,255,.08) 0%, rgba(255,255,255,.04) 100%);
      border: 2px solid rgba(139,0,0,.3);
      border-radius: 16px;
      padding: 14px;
      position: relative;
      box-shadow: 
        0 8px 25px rgba(0,0,0,.3),
        inset 0 1px 0 rgba(255,255,255,.1);
      transition: all 0.3s ease;
      will-change: transform, border-color, box-shadow;
    }

    .kpi::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--buffalo-red), var(--buffalo-orange), var(--buffalo-gold));
      border-radius: 16px 16px 0 0;
    }

    .kpi:hover {
      transform: translateY(-3px);
      border-color: var(--buffalo-orange);
      box-shadow: 
        0 15px 35px rgba(0,0,0,.4),
        inset 0 1px 0 rgba(255,255,255,.15),
        0 0 25px rgba(255,69,0,.2);
    }

    .kpi .k{ 
      color: var(--muted); 
      font-size: 12px; 
      margin-bottom: 12px;
      text-transform: uppercase;
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    .kpi .v{ 
      font-weight: 900; 
      font-size: 28px;
      background: linear-gradient(135deg, var(--buffalo-gold), var(--buffalo-orange));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 0 20px rgba(255,69,0,.3);
    }

    /* Performance Metrics - Enhanced KPI Design */
    .perf-metrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 12px;
      margin-top: 15px;
    }

    .perf-kpi {
      position: relative;
      background: linear-gradient(135deg, rgba(255,255,255,.08) 0%, rgba(255,255,255,.03) 100%);
      border: 2px solid rgba(139,0,0,.25);
      border-radius: 16px;
      padding: 20px 16px;
      display: flex;
      align-items: center;
      gap: 12px;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 
        0 4px 15px rgba(0,0,0,.2),
        inset 0 1px 0 rgba(255,255,255,.08);
      overflow: hidden;
      cursor: default;
    }

    .perf-kpi::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, transparent, var(--buffalo-red), transparent);
      opacity: 0;
      transition: opacity 0.4s ease;
    }

    .perf-kpi::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(255,69,0,.2), transparent);
      transform: translate(-50%, -50%);
      transition: width 0.6s ease, height 0.6s ease;
    }

    .perf-kpi:hover {
      transform: translateY(-5px) scale(1.02);
      border-color: var(--buffalo-orange);
      box-shadow: 
        0 12px 35px rgba(0,0,0,.35),
        inset 0 1px 0 rgba(255,255,255,.15),
        0 0 30px rgba(255,69,0,.25);
    }

    .perf-kpi:hover::before {
      opacity: 1;
    }

    .perf-kpi:hover::after {
      width: 200%;
      height: 200%;
    }

    .perf-week { border-color: rgba(139,0,0,.3); }
    .perf-week:hover { border-color: var(--buffalo-red); }

    .perf-month { border-color: rgba(255,215,0,.3); }
    .perf-month:hover { border-color: var(--buffalo-gold); }

    .perf-avg { border-color: rgba(76,175,80,.3); }
    .perf-avg:hover { border-color: #4CAF50; }

    .perf-icon {
      font-size: 36px;
      line-height: 1;
      filter: drop-shadow(0 2px 8px rgba(0,0,0,.3));
      transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 2;
    }

    .perf-kpi:hover .perf-icon {
      transform: scale(1.15) rotate(5deg);
    }

    .perf-content {
      flex: 1;
      z-index: 2;
    }

    .perf-label {
      font-size: 11px;
      color: var(--muted);
      text-transform: uppercase;
      font-weight: 600;
      letter-spacing: 0.5px;
      margin-bottom: 4px;
    }

    .perf-value {
      font-size: 32px;
      font-weight: 900;
      line-height: 1;
      background: linear-gradient(135deg, var(--buffalo-gold), var(--buffalo-orange));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 2px;
      transition: all 0.3s ease;
    }

    .perf-kpi:hover .perf-value {
      transform: scale(1.05);
      filter: drop-shadow(0 0 10px rgba(255,69,0,.4));
    }

    .perf-week .perf-value {
      background: linear-gradient(135deg, var(--buffalo-red), var(--buffalo-orange));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .perf-month .perf-value {
      background: linear-gradient(135deg, var(--buffalo-gold), #ffed4e);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .perf-avg .perf-value {
      background: linear-gradient(135deg, #4CAF50, #81C784);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .perf-sublabel {
      font-size: 10px;
      color: var(--muted);
      opacity: 0.7;
      font-weight: 500;
    }

    table{ 
      width: 100%; 
      border-collapse: collapse; 
      font-size: 13px;
      background: rgba(0,0,0,.3);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 8px 25px rgba(0,0,0,.3);
    }

    th, td{ 
      padding: 15px 12px; 
      border-bottom: 1px solid rgba(139,0,0,.2); 
      vertical-align: middle;
      transition: background 0.2s ease;
    }

    tr:hover td {
      background: rgba(255,69,0,.05);
    }

    th{ 
      background: linear-gradient(135deg, rgba(139,0,0,.35) 0%, rgba(139,0,0,.25) 100%);
      text-align: left;
      font-weight: 700;
      font-size: 11px;
      text-transform: uppercase;
      color: var(--buffalo-orange);
      letter-spacing: 0.8px;
      position: relative;
    }

    th::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--buffalo-orange), transparent);
      opacity: 0.5;
    }

    tr:hover {
      background: rgba(139,0,0,.1);
    }

    .tag-ok{ 
      color: #2ecc71;
      background: linear-gradient(135deg, rgba(46,204,113,.25) 0%, rgba(72,213,151,.15) 100%);
      padding: 6px 12px; 
      border-radius: 8px;
      display: inline-block;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border: 1px solid rgba(46,204,113,.3);
      box-shadow: 0 2px 8px rgba(46,204,113,.2);
      transition: all 0.2s ease;
    }

    .tag-ok:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(46,204,113,.3);
      border-color: #2ecc71;
    }

    .tag-no{ 
      color: #e74c3c;
      background: linear-gradient(135deg, rgba(231,76,60,.25) 0%, rgba(255,107,107,.15) 100%);
      padding: 6px 12px; 
      border-radius: 8px;
      display: inline-block;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border: 1px solid rgba(231,76,60,.3);
      box-shadow: 0 2px 8px rgba(231,76,60,.2);
      transition: all 0.2s ease;
    }

    .tag-no:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(231,76,60,.3);
      border-color: #e74c3c;
    }

    .help{ 
      font-size: 13px; 
      color: var(--muted); 
      line-height: 1.6;
      margin-top: 6px;
    }

    .mono{ 
      font-family: 'Courier New', 'Monaco', monospace;
      font-size: 13px;
    }

    ::-webkit-scrollbar {
      width: 12px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(0,0,0,.3);
      border-radius: 6px;
    }

    ::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, var(--buffalo-red), var(--buffalo-orange));
      border-radius: 6px;
      border: 2px solid rgba(0,0,0,.2);
    }

    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(135deg, var(--buffalo-orange), var(--buffalo-gold));
    }

    @keyframes pulse {
      0%, 100% { transform: translateY(-50%) scale(1) translateZ(0); }
      50% { transform: translateY(-50%) scale(1.15) translateZ(0); }
    }

    @keyframes button-pulse {
      0%, 100% { box-shadow: 0 8px 25px rgba(255,69,0,.4); }
      50% { box-shadow: 0 8px 35px rgba(255,69,0,.6), 0 0 20px rgba(255,69,0,.3); }
    }

    @media (max-width: 1200px){
      .buffalo-hero {
        right: -300px;
        width: 600px;
        opacity: 0.15;
      }
      
      .buffalo-skull {
        width: 200px;
        height: 200px;
        right: 50px;
        top: 60px;
      }
    }

    @media (max-width: 980px){
      .span4, .span6, .span8{ grid-column: span 12; }
      .row{ grid-template-columns: 1fr; }
      .row-3{ grid-template-columns: 1fr; }
      
      .buffalo-hero {
        display: none;
      }
      
      .buffalo-skull {
        width: 150px;
        height: 150px;
        right: 20px;
        top: 40px;
        opacity: 0.1;
      }

      h1 {
        font-size: 24px;
      }

      h1::after {
        position: static;
        margin-left: 15px;
        font-size: 30px;
      }

      .wrap {
        padding: 20px 15px 60px;
      }

      .grid {
        gap: 15px;
      }

      .card {
        padding: 20px;
      }
    }

    .storage-indicator {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: linear-gradient(135deg, rgba(139,0,0,.9), rgba(255,69,0,.8));
      color: white;
      padding: 10px 15px;
      border-radius: 25px;
      font-size: 12px;
      font-weight: 600;
      box-shadow: 0 4px 15px rgba(0,0,0,.3);
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .storage-indicator.show {
      opacity: 1;
    }

    .manual-section {
      background: rgba(255,69,0,.05);
      border: 1px solid rgba(255,69,0,.2);
      border-radius: 12px;
      padding: 10px;
      margin: 6px 0;
    }

    .manual-section h3 {
      margin: 0 0 6px;
      font-size: 14px;
      color: var(--buffalo-orange);
      text-transform: uppercase;
      font-weight: 700;
    }
  </style>
</head>
<body>
  <div class="buffalo-hero"></div>
  <div class="buffalo-skull"></div>
  <div class="particles" id="particles"></div>
  <div class="storage-indicator" id="storageIndicator">üíæ Dados salvos automaticamente</div>

  <div class="wrap">
    <div class="header">
      <h1>üêÉ Sistema de Pontua√ß√£o Atlanta</h1>
      <p class="sub">
        Rastreie atividades, calcule pontos e gere relat√≥rios
      </p>
    </div>

    <div class="grid">
      <!-- SE√á√ÉO 1: STREAMER E DESEMPENHO -->
      <div class="card span6">
        <h2>‚öîÔ∏è Streamer e Ciclo</h2>
        <div class="row">
          <div>
            <label>Streamer Ativo</label>
            <select id="streamerSelect"></select>
          </div>
          <div>
            <label>Novo Streamer</label>
            <input id="newStreamer" placeholder="Ex.: Lince" />
          </div>
        </div>
        <div class="row" style="margin-top:15px;">
          <button id="addStreamerBtn">üõ°Ô∏è Adicionar Streamer</button>
          <button id="removeStreamerBtn" class="danger">‚öîÔ∏è Remover Streamer</button>
        </div>

        <hr style="border:none;border-top:2px solid rgba(139,0,0,.3); margin:10px 0;">

        <div class="row">
          <div>
            <label>Ciclo</label>
            <select id="periodo">
              <option value="dia">Dia</option>
              <option value="semanal">Semanal</option>
              <option value="mensal">Mensal</option>
            </select>
          </div>
          <div>
            <label>Data de Refer√™ncia</label>
            <input id="refDate" type="date" value="2026-01-15" />
          </div>
        </div>

        <div class="manual-section">
          <h3>üèÜ Pontua√ß√£o Anterior</h3>
          <label>Total de pontos anteriores</label>
          <input id="pontosAnteriores" type="number" min="0" placeholder="Ex.: 150" />
          <button id="updatePontosBtn" style="margin-top:6px;">üíé Atualizar Pontos</button>
        </div>

        <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;">
          <span class="pill" id="pillPeriodo">‚Äî</span>
          <span class="pill">üéØ Sistema Atlanta Ativo</span>
        </div>
      </div>

      <div class="card span6">
        <h2>üìä Desempenho Individual</h2>
        
        <div class="perf-metrics">
          <div class="perf-kpi perf-week">
            <div class="perf-icon">üìÖ</div>
            <div class="perf-content">
              <div class="perf-label">Semana</div>
              <div class="perf-value" id="perfWeekPoints">‚Äî</div>
              <div class="perf-sublabel">pontos</div>
            </div>
          </div>
          
          <div class="perf-kpi perf-month">
            <div class="perf-icon">üìÜ</div>
            <div class="perf-content">
              <div class="perf-label">M√™s</div>
              <div class="perf-value" id="perfMonthPoints">‚Äî</div>
              <div class="perf-sublabel">pontos</div>
            </div>
          </div>
          
          <div class="perf-kpi perf-avg">
            <div class="perf-icon">üìà</div>
            <div class="perf-content">
              <div class="perf-label">M√©dia/Dia</div>
              <div class="perf-value" id="perfAvgDaily">‚Äî</div>
              <div class="perf-sublabel">pontos</div>
            </div>
          </div>
        </div>
      </div>

      <!-- SE√á√ÉO 2: ADICIONAR E LISTAR ATIVIDADES -->
      <div class="card span8">
        <h2>üìù Adicionar Atividades</h2>

        <div class="quick-start">
          <h3>‚ö° In√≠cio R√°pido</h3>
          <p><strong>1.</strong> Cole o texto com suas atividades</p>
          <p><strong>2.</strong> Clique em "Processar"</p>
          <p><strong>3.</strong> Gere o relat√≥rio</p>
        </div>

        <label for="bulkInput">üìù Cole aqui os lan√ßamentos</label>
        <textarea id="bulkInput" class="mono" placeholder="Exemplo:

„Éª1 V√≠deo no TikTok
„Éª1 Story Instagram
„Éª1 Reel Instagram
„Éª1 V√≠deo YouTube
„Éª1 Short YouTube

live 1: 4h
views youtube: 1200
raid twitch"></textarea>

        <div class="row" style="margin-top:20px;">
          <button id="processBulkBtn">‚ö° PROCESSAR</button>
        </div>

        <div class="collapse-section">
          <div class="collapse-header" onclick="toggleCollapse('advanced')">
            <span class="collapse-icon" id="advanced-icon">‚ñ∂</span>
            <span><strong>‚öôÔ∏è Op√ß√µes Avan√ßadas</strong></span>
          </div>
          <div class="collapse-content" id="advanced-content">
            
            <!-- SE√á√ÉO MANUAL -->
            <div style="padding:12px; background:rgba(255,69,0,.05); border:1px solid rgba(255,69,0,.2); border-radius:8px; margin-bottom:12px;">
              <h4 style="margin:0 0 10px; color:var(--buffalo-orange); font-size:12px; text-transform:uppercase; font-weight:700;">‚úã Adicionar Live / Views</h4>
              <div class="row" style="gap:10px;">
                <div style="flex:1;">
                  <label>üî¥ Live (horas)</label>
                  <input id="manualLiveHours" type="number" min="0" step="0.5" placeholder="4.5" />
                </div>
                <div style="flex:1;">
                  <label>üëÅÔ∏è Views</label>
                  <input id="manualViews" type="number" min="0" placeholder="1200" />
                </div>
                <div style="flex:1;">
                  <label>Plataforma</label>
                  <select id="manualPlatform">
                    <option value="twitch">Twitch</option>
                    <option value="youtube">YouTube</option>
                    <option value="tiktok">TikTok</option>
                    <option value="instagram">Instagram</option>
                    <option value="kwai">Kwai</option>
                    <option value="kick">Kick</option>
                  </select>
                </div>
              </div>
              <div class="row" style="margin-top:8px; gap:8px;">
                <button id="addManualLiveBtn" style="flex:1;">üî¥ Live</button>
                <button id="addManualViewsBtn" style="flex:1;">üëÅÔ∏è Views</button>
              </div>
            </div>
            
            <!-- SE√á√ÉO RAID -->
            <div style="padding:12px; background:rgba(139,0,0,.1); border-left:4px solid var(--buffalo-red); border-radius:8px; margin-top:12px;">
              <h4 style="margin:0 0 8px; color:var(--buffalo-red); font-size:12px; text-transform:uppercase; font-weight:700;">‚ö° Adicionar RAID</h4>
              <p style="font-size:11px; color:var(--muted); margin:0 0 8px;">‚ö†Ô∏è Limite: 1 raid por dia</p>
              <div class="row" style="gap:10px;">
                <div style="flex:1;">
                  <label>Data do RAID</label>
                  <input id="manualRaidDate" type="date" />
                </div>
                <div style="flex:0 0 auto;">
                  <button id="addManualRaidBtn" style="margin-top:18px;">‚ö° RAID (8pts)</button>
                </div>
              </div>
            </div>
            
          </div>
        </div>

        <div class="collapse-section" style="margin-top:12px;">
          <div class="collapse-header" onclick="toggleCollapse('help')">
            <span class="collapse-icon" id="help-icon">‚ñ∂</span>
            <span><strong>‚ùì Ajuda & Formatos</strong></span>
          </div>
          <div class="collapse-content" id="help-content">
            <p class="help">
              <strong>üìù Formatos aceitos:</strong><br>
              ‚Ä¢ <code>1 v√≠deo tik tok</code> ‚Ä¢ <code>1 story Instagram</code><br>
              ‚Ä¢ <code>live 1: 4h</code> ‚Ä¢ <code>views youtube: 1200</code><br>
              ‚Ä¢ <code>raid twitch</code><br><br>
              <strong>üí∞ Pontua√ß√£o:</strong> 3 pts por conte√∫do | Lives: vari√°vel | Views: at√© 36pts | RAID: 8pts (1/dia)
            </p>
          </div>
        </div>

        <div class="collapse-section">
          <div class="collapse-header" onclick="toggleCollapse('debug')">
            <span class="collapse-icon" id="debug-icon">‚ñ∂</span>
            <span><strong>üîç Debug</strong></span>
          </div>
          <div class="collapse-content" id="debug-content">
            <textarea id="debugOutput" class="mono" style="min-height:100px;" placeholder="Atividades reconhecidas..." readonly></textarea>
          </div>
        </div>
      </div>

      <div class="card span4">
        <h2>üóÇÔ∏è Atividades</h2>
        <table>
          <thead>
            <tr>
              <th>Data</th>
              <th>Plat.</th>
              <th>Tipo</th>
              <th>Status</th>
              <th>Pts</th>
            </tr>
          </thead>
          <tbody id="auditBody"></tbody>
        </table>
        <div class="row" style="margin-top:15px;">
          <button id="removeSelectedBtn" class="danger">üóëÔ∏è Remover</button>
          <button id="clearAllStreamerBtn" class="danger">üí• Limpar Tudo</button>
        </div>
      </div>

      <!-- SE√á√ÉO 3: RESUMO √âPICO E MENSAGEM -->
      <div class="card span12">
        <h2>üëë Resumo √âpico & Mensagem de Guerra</h2>
        <div class="kpis">
          <div class="kpi">
            <div class="k">‚öîÔ∏è Pontos do Ciclo</div>
            <div class="v" id="kPontosPeriodo">‚Äî</div>
          </div>
          <div class="kpi">
            <div class="k">üèÜ Total Acumulado</div>
            <div class="v" id="kTotal">‚Äî</div>
          </div>
          <div class="kpi">
            <div class="k">üì¶ Conte√∫do</div>
            <div class="v" id="kConteudo">‚Äî</div>
          </div>
          <div class="kpi">
            <div class="k">üî¥ Lives</div>
            <div class="v" id="kLives">‚Äî</div>
          </div>
          <div class="kpi">
            <div class="k">üëÅÔ∏è Views</div>
            <div class="v" id="kViews">‚Äî</div>
          </div>
          <div class="kpi">
            <div class="k">‚ö° A√ß√µes</div>
            <div class="v" id="kAcoes">‚Äî</div>
          </div>
        </div>

        <div class="row" style="margin-top:20px;">
          <button id="generateMsgBtn">üî• GERAR MENSAGEM √âPICA</button>
          <button id="copyMsgBtn" class="secondary">üìã COPIAR PODER</button>
        </div>

        <div class="collapse-section" style="margin-top:10px;">
          <div class="collapse-header" onclick="toggleCollapse('emoji')">
            <span class="collapse-icon" id="emoji-icon">‚ñ∂</span>
            <span><strong>üéâ Personalize o Emoji do Relat√≥rio</strong></span>
          </div>
          <div class="collapse-content" id="emoji-content">
            <label>Digite o emoji desejado:</label>
            <div class="row" style="margin-top:10px; gap:10px;">
              <input id="emojiInput" type="text" maxlength="5" placeholder="üêÉ" style="flex:1; font-size:18px; text-align:center;" />
              <button id="emojiResetBtn" class="secondary" style="flex:0 0 auto;">‚Üª Padr√£o</button>
            </div>
            <p style="font-size:11px; color:var(--muted); margin-top:8px;">üí° Cole ou digite qualquer emoji para personalizar seus relat√≥rios</p>
          </div>
        </div>

        <div style="margin-top:20px;">
          <label>Mensagem √âpica (Discord / Relat√≥rio)</label>
          <textarea id="msgOut" class="mono" placeholder="Clique em 'GERAR MENSAGEM √âPICA' para invocar o poder do B√∫falo..."></textarea>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Sistema de recompensas
    const TABELA_RESGATES = {
      "PIX": [{ nome: "200 reais no pix", pontos: 600, limite: "apenas um resgate por m√™s" }],
      "CAIXAS": [
        { nome: "1 Caixa de Armas Inicial", pontos: 20 },
        { nome: "1 Caixa de Armas Mediana", pontos: 50 },
        { nome: "1 Caixa de Armas Profissional", pontos: 100 }
      ],
      "PERSONAGEM": [
        { nome: "Tamanho Personalizado", pontos: 100 },
        { nome: "Segundo Personagem (M√°ximo 5 slots)", pontos: 170 },
        { nome: "+ 210 espa√ßo mochila (30 dias)", pontos: 210 },
        { nome: "+ 280 espa√ßo mochila (30 dias)", pontos: 280 },
        { nome: "+ 300 espa√ßo mochila (30 dias)", pontos: 300 },
        { nome: "Segundo Job", pontos: 600 }
      ],
      "CAVALOS": [
        { nome: "Cavalo at√© 500 d√≥lares", pontos: 50 },
        { nome: "Cavalo at√© 1000 d√≥lares", pontos: 100 },
        { nome: "Cavalo at√© 2000 d√≥lares", pontos: 200 }
      ],
      "BARRAS DE OURO": [
        { nome: "30 Barras de Ouro", pontos: 30 },
        { nome: "50 Barras de Ouro", pontos: 50 },
        { nome: "100 Barras de Ouro", pontos: 100 },
        { nome: "150 Barras de Ouro", pontos: 150 },
        { nome: "200 Barras de Ouro", pontos: 200 }
      ],
      "ARMAS": [
        { nome: "Mauser", pontos: 40 },
        { nome: "M1899", pontos: 40 },
        { nome: "Personaliza√ß√£o de Arma", pontos: 50 },
        { nome: "Faca Personalizada", pontos: 70 },
        { nome: "Rifle de Ferrolho", pontos: 80 },
        { nome: "Repetidora Winchester", pontos: 80 },
        { nome: "Shotgun Double", pontos: 80 },
        { nome: "Revolver Navy", pontos: 400 },
        { nome: "Rolling Block Rifle", pontos: 500 }
      ],
      "CARRO√áAS": [
        { nome: "Carro√ßa (at√© 200 gold)", pontos: 200 },
        { nome: "Carro√ßa (at√© 500 gold)", pontos: 500 }
      ],
      "HERAN√áAS": [
        { nome: "Vip Ouro", pontos: 100 },
        { nome: "Vip Platina", pontos: 250 },
        { nome: "Vip Diamante", pontos: 500 }
      ]
    };

    function getAvailableRewards(totalPontos) {
      const available = [];
      Object.keys(TABELA_RESGATES).forEach(categoria => {
        TABELA_RESGATES[categoria].forEach(item => {
          if (totalPontos >= item.pontos) {
            available.push({ ...item, categoria });
          }
        });
      });
      return available.sort((a, b) => b.pontos - a.pontos).slice(0, 3);
    }

    function getRewardsText(totalPontos) {
      const rewards = getAvailableRewards(totalPontos);
      if (rewards.length === 0) {
        return "Continue acumulando pontos para desbloquear resgates! üéØ";
      }
      let text = "üéÅ **Resgates Dispon√≠veis**\n";
      text += ">‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ<\n";
      rewards.forEach((reward, idx) => {
        text += `> ‚úÖ ${idx + 1}) ${reward.nome} ‚Äî **${reward.pontos} pts**\n`;
      });
      text += ">‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ<\n";
      text += "üíé Fale com a administra√ß√£o para resgatar.\n";
      return text.trim();
      return text;
    }

    // Sistema de dados
    const STORAGE_KEY = "atlanta_buffalo_v8";
    const BACKUP_KEY = "atlanta_buffalo_backup_v8";

    function saveStateEnhanced(state) {
      try {
        const compressedState = JSON.stringify(state);
        localStorage.setItem(STORAGE_KEY, compressedState);
        
        if (!saveStateEnhanced.lastBackup || Date.now() - saveStateEnhanced.lastBackup > 30000) {
          const backup = { data: state, timestamp: Date.now(), version: "8.0" };
          localStorage.setItem(BACKUP_KEY, JSON.stringify(backup));
          saveStateEnhanced.lastBackup = Date.now();
        }
        
        showStorageIndicator("üíæ Dados salvos com seguran√ßa!");
        return true;
      } catch (error) {
        console.error("Erro ao salvar dados:", error);
        showStorageIndicator("‚ùå Erro ao salvar dados!", true);
        return false;
      }
    }

    function loadStateEnhanced() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (raw) {
          const state = JSON.parse(raw);
          showStorageIndicator("‚úÖ Dados carregados!");
          return state;
        }
        
        const backupRaw = localStorage.getItem(BACKUP_KEY);
        if (backupRaw) {
          const backup = JSON.parse(backupRaw);
          showStorageIndicator("üîÑ Dados restaurados do backup!");
          return backup.data;
        }
        
        return {
          streamers: { "Lince": { pontosAnteriores: 0, atividades: [] } },
          settings: { theme: "dark", autoSave: true, quality: "ultra" },
          stats: { totalSessions: 0, lastAccess: Date.now() }
        };
      } catch (error) {
        console.error("Erro ao carregar dados:", error);
        showStorageIndicator("‚ùå Erro ao carregar dados!", true);
        return { streamers: {}, settings: {}, stats: {} };
      }
    }

    function showStorageIndicator(message, isError = false) {
      const indicator = document.getElementById('storageIndicator');
      indicator.textContent = message;
      indicator.style.background = isError ? 
        'linear-gradient(135deg, rgba(255,107,107,.9), rgba(255,71,87,.8))' :
        'linear-gradient(135deg, rgba(139,0,0,.9), rgba(255,69,0,.8))';
      indicator.classList.add('show');
      
      setTimeout(() => {
        indicator.classList.remove('show');
      }, 3000);
    }

    // Sistema de regras
    const REGRAS_PONTOS = {
      tiktok: { video:{pontos:3,limiteDia:1}, stories:{pontos:3,limiteDia:1} },
      kwai: { video:{pontos:3,limiteDia:1}, stories:{pontos:3,limiteDia:1} },
      instagram: { feed:{pontos:3,limiteDia:1}, reels:{pontos:3,limiteDia:1}, stories:{pontos:3,limiteDia:1} },
      youtube: { video:{pontos:3,limiteDia:1}, shorts:{pontos:3,limiteDia:1}, stories:{pontos:3,limiteDia:1}, post:{pontos:3,limiteDia:1} },
      kick: { video:{pontos:3,limiteDia:1} },
      twitch: { raid:{pontos:8,limiteDia:1}, stories:{pontos:3,limiteDia:1} },
      codigo: { indicacao:{pontos:5} }
    };

    function calcularPontosLive(horas) {
      if (typeof horas !== "number" || isNaN(horas)) return 0;
      if (horas < 1) return 0;
      return Math.min(Math.floor(horas), 20);
    }

    function calcularPontosViews(views) {
      if (typeof views !== "number" || isNaN(views)) return 0;
      if (views < 100) return 2;
      if (views >= 3000) return 36;
      if (views >= 2000) return 24;
      if (views >= 1000) return 12;
      if (views >= 800) return 10;
      if (views >= 500) return 8;
      if (views >= 350) return 6;
      if (views >= 100) return 4;
      return 2;
    }

    function normalizarTipo(plataforma, tipo){
      if (plataforma === "kwai" && tipo === "feed") return "video";
      if (plataforma === "youtube" && tipo === "post") return "post";
      return tipo;
    }

    function nomeTipo(plataforma, tipo){
      const t = normalizarTipo(plataforma, tipo);
      const map = {
        video: "V√≠deo", stories: "Stories", feed: "Postagem no feed",
        reels: "Reels", shorts: "Shorts", raid: "Raid", indicacao: "Indica√ß√£o", post: "Post"
      };
      return map[t] || tipo;
    }

    function nomePlataforma(p){
      const map = { 
        tiktok:"TikTok", kwai:"Kwai", instagram:"Instagram", 
        youtube:"YouTube", twitch:"Twitch", kick:"Kick", codigo:"C√≥digo" 
      };
      return map[p] || p;
    }

    // Fun√ß√µes de data
    const dateCache = new Map();

    function toDateOnlyISO(d) {
      const key = d.getTime();
      if (dateCache.has(key)) return dateCache.get(key);
      
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth()+1).padStart(2,"0");
      const dd = String(d.getDate()).padStart(2,"0");
      const result = `${yyyy}-${mm}-${dd}`;
      
      dateCache.set(key, result);
      return result;
    }

    function parseISODate(iso) {
      const cacheKey = `parse_${iso}`;
      if (dateCache.has(cacheKey)) return dateCache.get(cacheKey);
      
      const [y,m,d] = iso.split("-").map(Number);
      const result = new Date(y, m-1, d, 12, 0, 0, 0);
      
      dateCache.set(cacheKey, result);
      return result;
    }

    function startOfWeek(d) {
      const x = new Date(d);
      const day = x.getDay();
      const diff = (day === 0 ? -6 : 1 - day);
      x.setDate(x.getDate() + diff);
      x.setHours(12,0,0,0);
      return x;
    }

    function endOfWeek(d) {
      const s = startOfWeek(d);
      const e = new Date(s);
      e.setDate(e.getDate() + 6);
      e.setHours(12,0,0,0);
      return e;
    }

    function startOfMonth(d) { return new Date(d.getFullYear(), d.getMonth(), 1, 12,0,0,0); }
    function endOfMonth(d) { return new Date(d.getFullYear(), d.getMonth()+1, 0, 12,0,0,0); }

    function labelPeriodo(periodo, refDateISO) {
      const d = parseISODate(refDateISO);
      if (periodo === "dia") return refDateISO;
      if (periodo === "semanal") {
        const s = startOfWeek(d), e = endOfWeek(d);
        return `${toDateOnlyISO(s)} a ${toDateOnlyISO(e)}`;
      }
      const s = startOfMonth(d), e = endOfMonth(d);
      return `${toDateOnlyISO(s)} a ${toDateOnlyISO(e)}`;
    }

    function filtrarPorPeriodo(atividades, periodo, refDateISO) {
      const ref = parseISODate(refDateISO);
      let ini, fim;

      if (periodo === "dia") { ini = parseISODate(refDateISO); fim = parseISODate(refDateISO); }
      else if (periodo === "semanal") { ini = startOfWeek(ref); fim = endOfWeek(ref); }
      else { ini = startOfMonth(ref); fim = endOfMonth(ref); }

      const iniISO = toDateOnlyISO(ini);
      const fimISO = toDateOnlyISO(fim);

      return atividades.filter(a => a.data >= iniISO && a.data <= fimISO);
    }

    // Estado principal
    let state = loadStateEnhanced();

    // Carregar emoji customizado do localStorage
    window.addEventListener('DOMContentLoaded', () => {
      const savedEmoji = localStorage.getItem("customReportEmoji");
      if (savedEmoji) {
        document.getElementById("emojiInput").value = savedEmoji;
      }
    });

    // Cache de c√°lculos
    const calculationCache = new Map();

    function calcularPeriodoStreamer(streamer, periodo, refDateISO){
      const cacheKey = `${streamer}_${periodo}_${refDateISO}_${JSON.stringify(state.streamers[streamer]?.atividades || [])}`;
      if (calculationCache.has(cacheKey)) return calculationCache.get(cacheKey);
      
      const s = state.streamers[streamer];
      if (!s) return { pontosPeriodo: 0, total: 0, auditoria: [] };
      
      const atividadesPeriodo = filtrarPorPeriodo(s.atividades, periodo, refDateISO);

      const controleDiarioConteudo = {};
      const auditoria = [];

      let pontosConteudo = 0;
      let pontosLives = 0;
      let pontosViews = 0;
      let pontosAcoes = 0;

      const gruposConteudo = {};
      const livesDetalhe = [];
      const viewsDetalhe = [];
      const acoesDetalhe = [];

      let conteudosPontuados = 0;

      for (const a of atividadesPeriodo){
        const data = a.data;
        const categoria = a.categoria || "conteudo";
        const plataforma = a.plataforma || "desconhecida";
        const tipoOriginal = a.tipo || "-";
        const tipo = normalizarTipo(plataforma, tipoOriginal);

        if (categoria === "live"){
          const pts = calcularPontosLive(Number(a.horas));
          if (pts > 0){
            pontosLives += pts;
            livesDetalhe.push({ data, plataforma, horas: Number(a.horas), pontos: pts });
            auditoria.push({ id:a.id, data, categoria, plataforma, tipo:"live", status:"Pontuado", pontos:pts });
          } else {
            auditoria.push({ id:a.id, data, categoria, plataforma, tipo:"live", status:"Ignorado (horas < 1)", pontos:0 });
          }
          continue;
        }

        if (categoria === "views"){
          if (tipo === "reels" || tipo === "shorts"){
            auditoria.push({ id:a.id, data, categoria, plataforma, tipo:tipoOriginal, status:"Ignorado (views n√£o contam p/ reels/shorts)", pontos:0 });
            continue;
          }
          const pts = calcularPontosViews(Number(a.views));
          if (pts > 0){
            pontosViews += pts;
            viewsDetalhe.push({ data, plataforma, tipo: tipoOriginal, views: Number(a.views), pontos: pts });
            auditoria.push({ id:a.id, data, categoria, plataforma, tipo:tipoOriginal, status:"Pontuado", pontos:pts });
          } else {
            auditoria.push({ id:a.id, data, categoria, plataforma, tipo:tipoOriginal, status:"Ignorado (faixa sem pontos)", pontos:0 });
          }
          continue;
        }

        if (categoria === "raid"){
          const regra = REGRAS_PONTOS.twitch.raid;
          
          // Verificar se j√° existe um raid nesta data
          const raidExistenteNaData = atividadesPeriodo.some(
            at => at.categoria === "raid" && at.data === data && at.id !== a.id
          );
          
          if (raidExistenteNaData) {
            auditoria.push({ id:a.id, data, categoria, plataforma, tipo:"raid", status:"Ignorado (limite 1 por dia)", pontos:0 });
            continue;
          }
          
          pontosAcoes += regra.pontos;
          acoesDetalhe.push({ data, acao:"Raid", plataforma, pontos: regra.pontos });
          auditoria.push({ id:a.id, data, categoria, plataforma, tipo:"raid", status:"Pontuado", pontos:regra.pontos });
          continue;
        }

        if (categoria === "codigo"){
          const regra = REGRAS_PONTOS.codigo.indicacao;
          const qtd = Number(a.quantidade || 1);
          const pts = regra.pontos * (isNaN(qtd) ? 1 : qtd);
          pontosAcoes += pts;
          acoesDetalhe.push({ data, acao:"Indica√ß√£o", plataforma:"codigo", pontos: pts });
          auditoria.push({ id:a.id, data, categoria, plataforma:"codigo", tipo:"indicacao", status:"Pontuado", pontos:pts });
          continue;
        }

        const regra = REGRAS_PONTOS[plataforma]?.[tipo];
        if (!regra){
          auditoria.push({ id:a.id, data, categoria, plataforma, tipo:tipoOriginal, status:"Ignorado (sem regra)", pontos:0 });
          continue;
        }

        // Removido limite di√°rio - conta todas as publica√ß√µes
        pontosConteudo += regra.pontos;
        conteudosPontuados += 1;

        const label = `${nomeTipo(plataforma, tipo)} ${nomePlataforma(plataforma)}`;
        if (!gruposConteudo[label]) gruposConteudo[label] = { count: 0, pontos: 0 };
        gruposConteudo[label].count += 1;
        gruposConteudo[label].pontos += regra.pontos;

        auditoria.push({ id:a.id, data, categoria, plataforma, tipo:tipoOriginal, status:"Pontuado", pontos:regra.pontos });
      }

      const pontosPeriodo = pontosConteudo + pontosLives + pontosViews + pontosAcoes;
      const total = (s.pontosAnteriores || 0) + pontosPeriodo;

      const result = {
        atividadesPeriodo, auditoria,
        pontosConteudo, pontosLives, pontosViews, pontosAcoes,
        pontosPeriodo, total, conteudosPontuados,
        gruposConteudo, livesDetalhe, viewsDetalhe, acoesDetalhe
      };
      
      calculationCache.set(cacheKey, result);
      
      if (calculationCache.size > 100) {
        const firstKey = calculationCache.keys().next().value;
        calculationCache.delete(firstKey);
      }
      
      return result;
    }

    // Parser de texto
    function uuid(){
      return Math.random().toString(16).slice(2) + "-" + Date.now().toString(16);
    }

    function parseBulkInput(text, dataISO) {
      const linhas = text.split("\n").map(l => l.trim()).filter(Boolean);
      const atividades = [];

      // Fun√ß√£o para extrair plataforma de URL
      function getPlatformaFromUrl(url) {
        if (!url) return null;
        const urlLower = url.toLowerCase();
        if (urlLower.includes('tiktok.com') || urlLower.includes('vt.tiktok.com')) return 'tiktok';
        if (urlLower.includes('instagram.com')) return 'instagram';
        if (urlLower.includes('youtube.com') || urlLower.includes('youtu.be')) return 'youtube';
        // Kwai: cobrir dom√≠nios comuns e fallback amplo
        if (urlLower.includes('kwai.com') || urlLower.includes('k.kwai.com') || urlLower.includes('kw.ai') || urlLower.includes('/kwai/') || urlLower.includes('kwai')) return 'kwai';
        if (urlLower.includes('kick.com')) return 'kick';
        return null;
      }

      // Fun√ß√£o para tentar inferir plataforma a partir do texto (quando URL n√£o ajuda)
      function getPlatformFromText(text) {
        if (!text) return null;
        const t = text.toLowerCase();
        if (/(tik\s*tok|tiktok)/.test(t)) return 'tiktok';
        if (/instagram/.test(t)) return 'instagram';
        if (/youtube|youtu\.be/.test(t)) return 'youtube';
        if (/\bkwai\b/.test(t)) return 'kwai';
        if (/\bkick\b/.test(t)) return 'kick';
        return null;
      }

      // Fun√ß√£o para extrair tipo de conte√∫do de URL
      function getTipoFromUrl(url) {
        if (!url) return 'video';
        const urlLower = url.toLowerCase();
        if (urlLower.includes('/shorts/') || urlLower.includes('youtube.com/shorts')) return 'shorts';
        if (urlLower.includes('/reel/')) return 'reels';
        if (urlLower.includes('/stories/') || urlLower.includes('/stories')) return 'stories';
        if (urlLower.includes('/post/') || urlLower.includes('youtube.com/post')) return 'post';
        if (urlLower.includes('/p/') && urlLower.includes('instagram')) return 'feed';
        return 'video';
      }

      for (let i = 0; i < linhas.length; i++) {
        const linha = linhas[i];
        const l = linha.toLowerCase();

        // Pular cabe√ßalhos e linhas irrelevantes primeiro
        if (l.match(/^(tiktok|kwai|instagram|youtube|kick|twitch)\s*\(pontos\)$/)) continue;
        if (l.match(/^[a-zA-Z0-9_]+$/)) continue;
        // Ignorar ru√≠dos comuns de p√°ginas/apps (ex.: artefatos do Kwai)
        if (l === 'kwai-nuxt-pwa-pc' || l === 'make everyone shine') continue;
        
        // NOVO: Parser para formato com timestamp [HH:MM]Streamer: Tipo Plataforma URL
        // Exemplos:
        // "[21:00]Ragnar Stormborn #2879: Tiktok v√≠deo https://vt.tiktok.com/ZS5KryGMu/"
        // "[21:01]Ragnar Stormborn #2879: YouTube Shorts https://youtube.com/shorts/ZetIGXbexI4"
        let timestampMatch = linha.match(/^\[(\d{2}):(\d{2})\]\s*[^:]+:\s*(.+)$/);
        if (timestampMatch) {
          const activityText = timestampMatch[3];
          const urlMatch = activityText.match(/(https?:\/\/[^\s]+)/);
          const url = urlMatch ? urlMatch[1] : null;
          const platform = getPlatformaFromUrl(url) || getPlatformFromText(activityText);
          
          if (platform) {
            // Extrair tipo da descri√ß√£o da atividade
            let tipo = 'video';
            const actLower = activityText.toLowerCase();
            
            if (actLower.includes('story') || actLower.includes('stories')) {
              tipo = 'stories';
            } else if (actLower.includes('reel') || actLower.includes('reels')) {
              tipo = 'reels';
            } else if (actLower.includes('short') || actLower.includes('shorts')) {
              tipo = 'shorts';
            } else if (actLower.includes('feed')) {
              tipo = 'feed';
            } else if (actLower.includes('post')) {
              tipo = 'post';
            }
            
            atividades.push({
              id: uuid(), data: dataISO, categoria: "conteudo",
              plataforma: platform, tipo: tipo, url: url
            });
            continue;
          }
        }

        // Pular linhas que s√£o apenas timestamps
        if (l.match(/^\[\d{2}:\d{2}\]$/)) continue;
        if (l.match(/^\d{2}:\d{2}$/)) continue;

        // Extrair URL da linha atual ou pr√≥xima
        let url = null;
        let urlMatch = linha.match(/(https?:\/\/[^\s]+)/);
        if (urlMatch) {
          url = urlMatch[1];
        } else if (i + 1 < linhas.length) {
          // Verificar se pr√≥xima linha √© uma URL
          const nextMatch = linhas[i + 1].match(/^(https?:\/\/[^\s]+)/);
          if (nextMatch) {
            url = nextMatch[1];
          }
        }

        // Se achamos URL, tentamos pontuar mesmo que haja texto antes/depois
        if (url) {
          let platform = getPlatformaFromUrl(url) || getPlatformFromText(linha);
          if (platform) {
            let tipo = getTipoFromUrl(url);
            if (l.includes('story') || l.includes('stories')) tipo = 'stories';
            else if (l.includes('reel')) tipo = 'reels';
            else if (l.includes('short')) tipo = 'shorts';
            else if (l.includes('feed')) tipo = 'feed';
            else if (l.includes('post')) tipo = 'post';
            atividades.push({
              id: uuid(), data: dataISO, categoria: "conteudo",
              plataforma: platform, tipo, url
            });
            continue;
          }
        }

        // Se √© uma URL pura, tentar processar com plataforma da URL
        if (l.match(/^https?:\/\//)) {
          const platform = getPlatformaFromUrl(linha);
          if (platform) {
            const tipo = getTipoFromUrl(linha);
            atividades.push({
              id: uuid(), data: dataISO, categoria: "conteudo",
              plataforma: platform, tipo, url: linha
            });
          }
          continue;
        }

        // FORMATO ESTRUTURADO COM BULLET POINTS („Éª) E URLS
        
        // Match: "„Éª1 V√≠deo no TikTok: URL" or "„Éª1 V√≠deo no TikTok"
        let m = l.match(/^[„Éª‚Ä¢\-\*]\s*(\d+)\s+(v[√≠i]deo|video)\s+no\s+(tiktok|tik\s*tok)(?:\s*:.*)?$/);
        if (m) {
          const qtd = Number(m[1]);
          for (let j = 0; j < qtd; j++) {
            atividades.push({
              id: uuid(), data: dataISO, categoria: "conteudo",
              plataforma: "tiktok", tipo: "video", url
            });
          }
          continue;
        }

        // Match: "„Éª1 Stories no TikTok" or variations
        m = l.match(/^[„Éª‚Ä¢\-\*]\s*(\d+)\s+(story|stories)\s+no\s+(tiktok|tik\s*tok)(?:\s*:.*)?$/);
        if (m) {
          const qtd = Number(m[1]);
          for (let j = 0; j < qtd; j++) {
            atividades.push({
              id: uuid(), data: dataISO, categoria: "conteudo",
              plataforma: "tiktok", tipo: "stories", url
            });
          }
          continue;
        }

        // Kwai V√≠deo
        m = l.match(/^[„Éª‚Ä¢\-\*]\s*(\d+)\s+(v[√≠i]deo|video)\s+no\s+kwai(?:\s*:.*)?$/);
        if (m) {
          const qtd = Number(m[1]);
          for (let j = 0; j < qtd; j++) {
            atividades.push({
              id: uuid(), data: dataISO, categoria: "conteudo",
              plataforma: "kwai", tipo: "video", url
            });
          }
          continue;
        }

        // Kwai Story
        m = l.match(/^[„Éª‚Ä¢\-\*]\s*(\d+)\s+(story|stories)\s+no\s+kwai(?:\s*:.*)?$/);
        if (m) {
          const qtd = Number(m[1]);
          for (let j = 0; j < qtd; j++) {
            atividades.push({
              id: uuid(), data: dataISO, categoria: "conteudo",
              plataforma: "kwai", tipo: "stories", url
            });
          }
          continue;
        }

        // Instagram - Postagem no feed
        m = l.match(/^[„Éª‚Ä¢\-\*]\s*(\d+)\s+(postagem|post)\s+no\s+feed\s+no\s+instagram(?:\s*:.*)?$/);
        if (m) {
          const qtd = Number(m[1]);
          for (let j = 0; j < qtd; j++) {
            atividades.push({
              id: uuid(), data: dataISO, categoria: "conteudo",
              plataforma: "instagram", tipo: "feed", url
            });
          }
          continue;
        }

        // Instagram - Reels
        m = l.match(/^[„Éª‚Ä¢\-\*]\s*(\d+)\s+(reels?)(?:\s+no\s+)?instagram(?:\s*:.*)?$/);
        if (m) {
          const qtd = Number(m[1]);
          for (let j = 0; j < qtd; j++) {
            atividades.push({
              id: uuid(), data: dataISO, categoria: "conteudo",
              plataforma: "instagram", tipo: "reels", url
            });
          }
          continue;
        }

        // Instagram - Story
        m = l.match(/^[„Éª‚Ä¢\-\*]\s*(\d+)\s+(story|stories)(?:\s+no\s+)?instagram(?:\s*:.*)?$/);
        if (m) {
          const qtd = Number(m[1]);
          for (let j = 0; j < qtd; j++) {
            atividades.push({
              id: uuid(), data: dataISO, categoria: "conteudo",
              plataforma: "instagram", tipo: "stories", url
            });
          }
          continue;
        }

        // YouTube - V√≠deo
        m = l.match(/^[„Éª‚Ä¢\-\*]\s*(\d+)\s+(v[√≠i]deo|video)\s+no\s+youtube(?:\s*:.*)?$/);
        if (m) {
          const qtd = Number(m[1]);
          for (let j = 0; j < qtd; j++) {
            atividades.push({
              id: uuid(), data: dataISO, categoria: "conteudo",
              plataforma: "youtube", tipo: "video", url
            });
          }
          continue;
        }

        // YouTube - Shorts
        m = l.match(/^[„Éª‚Ä¢\-\*]\s*(\d+)\s+(shorts?)(?:\s+no\s+)?youtube(?:\s*:.*)?$/);
        if (m) {
          const qtd = Number(m[1]);
          for (let j = 0; j < qtd; j++) {
            atividades.push({
              id: uuid(), data: dataISO, categoria: "conteudo",
              plataforma: "youtube", tipo: "shorts", url
            });
          }
          continue;
        }

        // YouTube - Story/Post
        m = l.match(/^[„Éª‚Ä¢\-\*]\s*(\d+)\s+(story|stories|post)(?:\s+no\s+)?youtube(?:\s*:.*)?$/);
        if (m) {
          const qtd = Number(m[1]);
          for (let j = 0; j < qtd; j++) {
            atividades.push({
              id: uuid(), data: dataISO, categoria: "conteudo",
              plataforma: "youtube", tipo: "post", url
            });
          }
          continue;
        }

        // Kick V√≠deo
        m = l.match(/^[„Éª‚Ä¢\-\*]\s*(\d+)\s+(v[√≠i]deo|video)(?:\s+no\s+)?kick(?:\s*:.*)?$/);
        if (m) {
          const qtd = Number(m[1]);
          for (let j = 0; j < qtd; j++) {
            atividades.push({
              id: uuid(), data: dataISO, categoria: "conteudo",
              plataforma: "kick", tipo: "video", url
            });
          }
          continue;
        }

        // Lives
        m = l.match(/(?:live\s*\d*[:\-]?\s*(\d+(?:\.\d+)?)h|(\d+(?:\.\d+)?)h?\s*live)/);
        if (m) {
          const horas = Number(m[1] || m[2]);
          atividades.push({
            id: uuid(), data: dataISO, categoria: "live",
            plataforma: "twitch", tipo: "live", horas: horas
          });
          continue;
        }

        // Views
        m = l.match(/(?:views?\s*(youtube|tiktok|kwai|instagram|kick)?\s*[:\-]?\s*(\d+)|(\d+)\s*views?\s*(youtube|tiktok|kwai|instagram|kick)?|(youtube|tiktok|kwai|instagram|kick)\s*views?\s*[:\-]?\s*(\d+))/);
        if (m) {
          const views = Number(m[2] || m[3] || m[6]);
          const plataforma = (m[1] || m[4] || m[5] || "youtube").toLowerCase();
          atividades.push({
            id: uuid(), data: dataISO, categoria: "views",
            plataforma: plataforma, tipo: "video", views: views
          });
          continue;
        }

        // Raids
        m = l.match(/(?:raid\s*(twitch)?\s*x?(\d+)?|(\d+)\s*raids?)/);
        if (m) {
          const qtd = Number(m[2] || m[3] || 1);
          for (let j = 0; j < qtd; j++) {
            atividades.push({
              id: uuid(), data: dataISO, categoria: "raid",
              plataforma: "twitch", tipo: "raid"
            });
          }
          continue;
        }

        // Indica√ß√µes
        m = l.match(/(?:indica[c√ß][a√£]o\s*x?(\d+)|(\d+)\s*indica[c√ß][√µo]es?|referrals?\s*x?(\d+)|(\d+)\s*referrals?)/);
        if (m) {
          const qtd = Number(m[1] || m[2] || m[3] || m[4]);
          atividades.push({
            id: uuid(), data: dataISO, categoria: "codigo",
            plataforma: "codigo", tipo: "indicacao", quantidade: qtd
          });
          continue;
        }

        // Fallback: Generic content matchers (less specific)
        m = l.match(/(?:(\d+)\s*)?(?:v[√≠i]deo|video)\s+(?:no\s+)?(tiktok|tik\s*tok|kwai|kick)/);
        if (m) {
          const qtd = Number(m[1] || 1);
          const platform = m[2].replace(/\s+/g, '').toLowerCase();
          for (let j = 0; j < qtd; j++) {
            atividades.push({
              id: uuid(), data: dataISO, categoria: "conteudo",
              plataforma: platform, tipo: "video", url
            });
          }
          continue;
        }

        m = l.match(/(?:(\d+)\s*)?(?:story|stories)\s+(?:no\s+)?(tiktok|tik\s*tok|kwai|kick)/);
        if (m) {
          const qtd = Number(m[1] || 1);
          const platform = m[2].replace(/\s+/g, '').toLowerCase();
          for (let j = 0; j < qtd; j++) {
            atividades.push({
              id: uuid(), data: dataISO, categoria: "conteudo",
              plataforma: platform, tipo: "stories", url
            });
          }
          continue;
        }

        m = l.match(/(?:(\d+)\s*)?(?:reels?)\s+(?:no\s+)?instagram/);
        if (m) {
          const qtd = Number(m[1] || 1);
          for (let j = 0; j < qtd; j++) {
            atividades.push({
              id: uuid(), data: dataISO, categoria: "conteudo",
              plataforma: "instagram", tipo: "reels", url
            });
          }
          continue;
        }

        m = l.match(/(?:(\d+)\s*)?(?:shorts?)\s+(?:no\s+)?youtube/);
        if (m) {
          const qtd = Number(m[1] || 1);
          for (let j = 0; j < qtd; j++) {
            atividades.push({
              id: uuid(), data: dataISO, categoria: "conteudo",
              plataforma: "youtube", tipo: "shorts", url
            });
          }
          continue;
        }

        // Parser de mensagens do Discord/WhatsApp (nomes com espa√ßos/#)
        m = l.match(/(?:\[\d{2}:\d{2}\]\s*)?[^:]+:\s*(.+)/);
        if (m) {
          const subAtividades = parseBulkInput(m[1], dataISO);
          atividades.push(...subAtividades);
          continue;
        }
      }

      return atividades;
    }

    // Gerador de mensagem Discord
    function gerarMensagemDiscord(streamer, periodo, refDateISO, r){
      const linhas = [];
      const rewardsText = getRewardsText(r.total);
      
      // Pegar emoji customizado ou usar padr√£o
      const emojiCustomizado = document.getElementById('emojiInput').value || 'üêÉ';

      linhas.push(`# <a:trofeu1:1432593868439949343> **Relat√≥rio de Pontua√ß√£o Streamers Atlanta** <a:trofeu1:1432593868439949343> ${emojiCustomizado}`);
      linhas.push(`### üì¶ Pontos por Conte√∫do e A√ß√£o`);
      
      // Agrupar conte√∫do por tipo e plataforma de forma clara
      const conteudoDetalhado = {};
      for (const [label, item] of Object.entries(r.gruposConteudo)) {
        if (!conteudoDetalhado[label]) {
          conteudoDetalhado[label] = { count: 0, pontos: 0 };
        }
        conteudoDetalhado[label].count += item.count;
        conteudoDetalhado[label].pontos += item.pontos;
      }

      // Exibir conte√∫do agrupado
      Object.keys(conteudoDetalhado).sort().forEach((k) => {
        const it = conteudoDetalhado[k];
        linhas.push(`> **${k}** (x${it.count}): ${it.pontos} pontos`);
      });

      // Exibir lives se houver
      if (r.livesDetalhe.length){
        r.livesDetalhe.forEach((l) => {
          const h = (typeof l.horas === "number" && !isNaN(l.horas)) ? l.horas : 0;
          linhas.push(`> **Lives Twitch** (${h}h): ${l.pontos} pontos`);
        });
      }

      // Exibir views se houver
      if (r.viewsDetalhe.length){
        r.viewsDetalhe.forEach((v) => {
          linhas.push(`> **${nomePlataforma(v.plataforma)} Views** (${v.views} views): ${v.pontos} pontos`);
        });
      }

      // Exibir a√ß√µes especiais se houver
      if (r.acoesDetalhe.length){
        r.acoesDetalhe.forEach((a) => {
          linhas.push(`> **${a.acao}**: ${a.pontos} pontos`);
        });
      }

      linhas.push(`### üìà Resumo`);
      linhas.push(`> **Pontos Deste Ciclo:** \`${r.pontosPeriodo} pontos\``);
      linhas.push(`> **Pontos Anteriores:** \`${state.streamers[streamer]?.pontosAnteriores || 0} pontos\``);
      linhas.push(``);
      linhas.push(`# ü™ô Pontua√ß√£o Total Atual: **${r.total} pontos**`);
      linhas.push(`üñ•Ô∏è Total de Publica√ß√µes no Ciclo: **${r.conteudosPontuados}**`);
      linhas.push(``);

      linhas.push(`---`);
      linhas.push(rewardsText);
      linhas.push(``);

      linhas.push(`*${emojiCustomizado} Powered by Sistema B√∫falo Atlanta*`);

      return linhas.join("\n");
    }

    // Fun√ß√µes de performance
    function calcularDesempenhoIndividual(streamer, mode) {
      const s = state.streamers[streamer];
      if (!s || !s.atividades.length) return [];

      const buckets = new Map();
      
      for (const a of s.atividades) {
        const d = parseISODate(a.data);
        let key;
        
        if (mode === "semanal") {
          const startWeek = startOfWeek(d);
          const endWeek = endOfWeek(d);
          key = `${toDateOnlyISO(startWeek)} a ${toDateOnlyISO(endWeek)}`;
        } else {
          const y = d.getFullYear();
          const m = String(d.getMonth()+1).padStart(2,"0");
          key = `${y}-${m}`;
        }
        
        if (!buckets.has(key)) {
          buckets.set(key, []);
        }
        buckets.get(key).push(a);
      }

      const results = [];
      for (const [periodo, atividades] of buckets) {
        const controleDiarioConteudo = {};
        let pontosConteudo = 0, pontosLives = 0, pontosViews = 0, pontosAcoes = 0;

        for (const a of atividades) {
          const categoria = a.categoria || "conteudo";
          const plataforma = a.plataforma || "desconhecida";
          const tipo = normalizarTipo(plataforma, a.tipo || "-");

          if (categoria === "live") {
            pontosLives += calcularPontosLive(Number(a.horas));
          } else if (categoria === "views") {
            if (tipo !== "reels" && tipo !== "shorts") {
              pontosViews += calcularPontosViews(Number(a.views));
            }
          } else if (categoria === "raid") {
            pontosAcoes += REGRAS_PONTOS.twitch.raid.pontos;
          } else if (categoria === "codigo") {
            const qtd = Number(a.quantidade || 1);
            pontosAcoes += REGRAS_PONTOS.codigo.indicacao.pontos * (isNaN(qtd) ? 1 : qtd);
          } else {
            const regra = REGRAS_PONTOS[plataforma]?.[tipo];
            if (regra) {
              // Removido limite di√°rio - conta todas as publica√ß√µes
              pontosConteudo += regra.pontos;
            }
          }
        }

        const pontosPeriodo = pontosConteudo + pontosLives + pontosViews + pontosAcoes;
        results.push({
          periodo, pontosPeriodo, pontosConteudo,
          pontosLives, pontosViews, pontosAcoes,
          atividades: atividades.length
        });
      }

      results.sort((a, b) => a.periodo.localeCompare(b.periodo));
      return results;
    }

    function formatDesempenhoText(results, titulo, streamer) {
      const lines = [];
      lines.push(`# üìä DESEMPENHO ${titulo.toUpperCase()} ‚Äî ${streamer.toUpperCase()} üêÉ`);
      lines.push(`*Evolu√ß√£o do streamer na arena Atlanta*`);
      lines.push(``);
      
      if (!results.length) {
        lines.push(`*üêÉ Ainda n√£o h√° dados de performance para este per√≠odo...*`);
        return lines.join("\n");
      }

      const totalPontos = results.reduce((sum, r) => sum + r.pontosPeriodo, 0);
      const mediaPontos = Math.round(totalPontos / results.length);
      const melhorPeriodo = results.reduce((max, r) => r.pontosPeriodo > max.pontosPeriodo ? r : max);
      
      lines.push(`### üèÜ **ESTAT√çSTICAS GERAIS**`);
      lines.push(`> **Total de Pontos:** ${totalPontos} pts`);
      lines.push(`> **M√©dia por Per√≠odo:** ${mediaPontos} pts`);
      lines.push(`> **Melhor Per√≠odo:** ${melhorPeriodo.periodo} (${melhorPeriodo.pontosPeriodo} pts)`);
      lines.push(``);

      lines.push(`### üìà **HIST√ìRICO DETALHADO**`);
      results.forEach((r, idx) => {
        const trend = idx > 0 ? 
          (r.pontosPeriodo > results[idx-1].pontosPeriodo ? "üìà" : 
           r.pontosPeriodo < results[idx-1].pontosPeriodo ? "üìâ" : "‚û°Ô∏è") : "üéØ";
        
        lines.push(`**${r.periodo}** ${trend}`);
        lines.push(`> üéØ **Total:** ${r.pontosPeriodo} pts | üì¶ Conte√∫do: ${r.pontosConteudo} | üî¥ Lives: ${r.pontosLives} | üëÅÔ∏è Views: ${r.pontosViews} | ‚ö° A√ß√µes: ${r.pontosAcoes}`);
        lines.push(`> üìä **Atividades:** ${r.atividades} registradas`);
        lines.push(``);
      });
      
      return lines.join("\n");
    }

    // Sistema de part√≠culas
    function createParticles() {
      const container = document.getElementById('particles');
      const particleCount = 20;
      
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.animationDelay = Math.random() * 8 + 's';
        particle.style.animationDuration = (8 + Math.random() * 4) + 's';
        container.appendChild(particle);
      }
    }

    // Fun√ß√µes de UI
    const $ = (id) => document.getElementById(id);

    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }

    function refreshStreamerSelect(){
      const sel = $("streamerSelect");
      sel.innerHTML = "";
      const names = Object.keys(state.streamers).sort();
      for (const n of names){
        const opt = document.createElement("option");
        opt.value = n;
        opt.textContent = n;
        sel.appendChild(opt);
      }
      if (!names.length){
        state.streamers["Streamer 1"] = { pontosAnteriores: 0, atividades: [] };
        saveStateEnhanced(state);
        return refreshStreamerSelect();
      }
    }

    function currentStreamer(){
      return $("streamerSelect").value;
    }

    const debouncedRender = debounce(function render(){
      const streamer = currentStreamer();
      const periodo = $("periodo").value;
      const refDateISO = $("refDate").value;

      $("pillPeriodo").textContent = labelPeriodo(periodo, refDateISO);
      $("pontosAnteriores").value = state.streamers[streamer]?.pontosAnteriores || 0;
      
      // Sincronizar campo de data do raid com a data de refer√™ncia
      $("manualRaidDate").value = refDateISO;

      const r = calcularPeriodoStreamer(streamer, periodo, refDateISO);

      $("kPontosPeriodo").textContent = r.pontosPeriodo;
      $("kTotal").textContent = r.total;
      $("kConteudo").textContent = r.pontosConteudo;
      $("kLives").textContent = r.pontosLives;
      $("kViews").textContent = r.pontosViews;
      $("kAcoes").textContent = r.pontosAcoes;

      // Update performance stats
      updatePerformanceStats();

      const tb = $("auditBody");
      tb.innerHTML = "";
      
      const fragment = document.createDocumentFragment();
      
      for (const row of r.auditoria){
        const tr = document.createElement("tr");
        const ok = row.status === "Pontuado";
        tr.innerHTML = `
          <td class="mono">
            <input type="checkbox" data-id="${row.id}" style="transform:scale(1.2); margin-right:10px; vertical-align:middle;">
            ${row.data}
          </td>
          <td>${row.categoria}</td>
          <td>${nomePlataforma(row.plataforma)}</td>
          <td>${row.tipo}</td>
          <td class="${ok ? "tag-ok" : "tag-no"}">${row.status}</td>
          <td><strong>${row.pontos}</strong></td>
        `;
        fragment.appendChild(tr);
      }
      
      tb.appendChild(fragment);
    }, 100);

    // Event handlers
    $("addStreamerBtn").addEventListener("click", () => {
      const name = $("newStreamer").value.trim();
      if (!name) return;
      if (state.streamers[name]) {
        showStorageIndicator("‚ö†Ô∏è Streamer j√° existe!", true);
        return;
      }
      state.streamers[name] = { pontosAnteriores: 0, atividades: [] };
      saveStateEnhanced(state);
      $("newStreamer").value = "";
      refreshStreamerSelect();
      $("streamerSelect").value = name;
      debouncedRender();
      showStorageIndicator(`üõ°Ô∏è Streamer ${name} adicionado!`);
      calculationCache.clear();
    });

    $("removeStreamerBtn").addEventListener("click", () => {
      const name = currentStreamer();
      if (!name) return;
      if (confirm(`üó°Ô∏è Tem certeza que deseja remover o streamer ${name} da arena?`)) {
        delete state.streamers[name];
        saveStateEnhanced(state);
        refreshStreamerSelect();
        debouncedRender();
        showStorageIndicator(`‚öîÔ∏è Streamer ${name} removido!`);
        calculationCache.clear();
      }
    });

    $("updatePontosBtn").addEventListener("click", () => {
      const streamer = currentStreamer();
      const pontos = parseInt($("pontosAnteriores").value) || 0;
      
      if (!state.streamers[streamer]) return;
      
      state.streamers[streamer].pontosAnteriores = pontos;
      saveStateEnhanced(state);
      debouncedRender();
      showStorageIndicator(`üíé Pontos anteriores atualizados: ${pontos}`);
      calculationCache.clear();
    });

    $("addManualLiveBtn").addEventListener("click", () => {
      const streamer = currentStreamer();
      const horas = parseFloat($("manualLiveHours").value);
      const plataforma = $("manualPlatform").value;
      const dataISO = $("refDate").value;
      
      if (!horas || horas <= 0) {
        showStorageIndicator("‚ö†Ô∏è Insira as horas da live!", true);
        return;
      }
      
      const novaAtividade = {
        id: uuid(), data: dataISO, categoria: "live",
        plataforma: plataforma, tipo: "live", horas: horas
      };
      
      state.streamers[streamer].atividades.push(novaAtividade);
      saveStateEnhanced(state);
      $("manualLiveHours").value = "";
      debouncedRender();
      showStorageIndicator(`üî¥ Live adicionada: ${horas}h`);
      calculationCache.clear();
    });

    $("addManualViewsBtn").addEventListener("click", () => {
      const streamer = currentStreamer();
      const views = parseInt($("manualViews").value);
      const plataforma = $("manualPlatform").value;
      const dataISO = $("refDate").value;
      
      if (!views || views <= 0) {
        showStorageIndicator("‚ö†Ô∏è Insira o n√∫mero de views!", true);
        return;
      }
      
      const novaAtividade = {
        id: uuid(), data: dataISO, categoria: "views",
        plataforma: plataforma, tipo: "video", views: views
      };
      
      state.streamers[streamer].atividades.push(novaAtividade);
      saveStateEnhanced(state);
      $("manualViews").value = "";
      debouncedRender();
      showStorageIndicator(`üëÅÔ∏è Views adicionadas: ${views}`);
      calculationCache.clear();
    });

    $("addManualRaidBtn").addEventListener("click", () => {
      const streamer = currentStreamer();
      const dataRaid = $("manualRaidDate").value;
      
      if (!dataRaid) {
        showStorageIndicator("‚ö†Ô∏è Selecione a data do RAID!", true);
        return;
      }
      
      // Verificar se j√° existe um raid nesta data
      const raidExistente = state.streamers[streamer].atividades.some(
        a => a.categoria === "raid" && a.data === dataRaid
      );
      
      if (raidExistente) {
        showStorageIndicator("‚ö†Ô∏è J√° existe um RAID registrado nesta data! (Limite: 1 por dia)", true);
        return;
      }
      
      const novaAtividade = {
        id: uuid(), data: dataRaid, categoria: "raid",
        plataforma: "twitch", tipo: "raid"
      };
      
      state.streamers[streamer].atividades.push(novaAtividade);
      saveStateEnhanced(state);
      $("manualRaidDate").value = "";
      debouncedRender();
      showStorageIndicator(`‚ö° RAID adicionado: ${dataRaid} (8 pontos)`);
      calculationCache.clear();
    });

    $("streamerSelect").addEventListener("change", debouncedRender);
    $("periodo").addEventListener("change", debouncedRender);
    $("refDate").addEventListener("change", debouncedRender);

    $("processBulkBtn").addEventListener("click", () => {
      const streamer = currentStreamer();
      const texto = $("bulkInput").value;
      const dataISO = $("refDate").value;
      if (!texto.trim()) {
        showStorageIndicator("‚ö†Ô∏è Cole os dados primeiro!", true);
        return;
      }
      
      const novasAtividades = parseBulkInput(texto, dataISO);
      
      let debugText = `üîç AN√ÅLISE DO PARSING (${novasAtividades.length} atividades reconhecidas):\n\n`;
      
      if (novasAtividades.length === 0) {
        debugText += "‚ùå NENHUMA ATIVIDADE RECONHECIDA!\n\n";
        debugText += "üìù LINHAS ANALISADAS:\n";
        const linhas = texto.split("\n").map(l => l.trim()).filter(Boolean);
        linhas.forEach((linha, idx) => {
          debugText += `${idx + 1}. "${linha}"\n`;
        });
        debugText += "\nüí° DICA: Verifique se o formato est√° correto. Exemplos:\n";
        debugText += "‚Ä¢ 1 v√≠deo tik tok\n‚Ä¢ 1 story Instagram\n‚Ä¢ live 1: 4h\n‚Ä¢ views youtube: 1200\n";
      } else {
        const grupos = {};
        novasAtividades.forEach(a => {
          const key = `${a.categoria}-${a.plataforma}-${a.tipo}`;
          if (!grupos[key]) grupos[key] = [];
          grupos[key].push(a);
        });
        
        Object.keys(grupos).forEach(key => {
          const ativs = grupos[key];
          const [categoria, plataforma, tipo] = key.split('-');
          debugText += `‚úÖ ${categoria.toUpperCase()}: ${nomePlataforma(plataforma)} - ${nomeTipo(plataforma, tipo)} (${ativs.length}x)\n`;
          
          if (categoria === 'live') {
            ativs.forEach(a => debugText += `   ‚îî ${a.horas}h\n`);
          } else if (categoria === 'views') {
            ativs.forEach(a => debugText += `   ‚îî ${a.views} views\n`);
          } else if (categoria === 'codigo') {
            ativs.forEach(a => debugText += `   ‚îî x${a.quantidade || 1}\n`);
          }
        });
      }
      
      $("debugOutput").value = debugText;
      
      if (novasAtividades.length === 0) {
        showStorageIndicator("‚ö†Ô∏è Nenhuma atividade reconhecida!", true);
        return;
      }
      
      state.streamers[streamer].atividades.push(...novasAtividades);
      saveStateEnhanced(state);
      $("bulkInput").value = "";
      debouncedRender();
      showStorageIndicator(`‚ö° ${novasAtividades.length} atividades processadas!`);
      calculationCache.clear();
    });

    // JSON import removed - use text parser instead

    $("generateMsgBtn").addEventListener("click", () => {
      const streamer = currentStreamer();
      const periodo = $("periodo").value;
      const refDateISO = $("refDate").value;
      const r = calcularPeriodoStreamer(streamer, periodo, refDateISO);
      $("msgOut").value = gerarMensagemDiscord(streamer, periodo, refDateISO, r);
      showStorageIndicator("üî• Mensagem √©pica gerada!");
    });

    $("copyMsgBtn").addEventListener("click", async () => {
      const text = $("msgOut").value;
      if (!text) {
        showStorageIndicator("‚ö†Ô∏è Gere a mensagem primeiro!", true);
        return;
      }
      try { 
        await navigator.clipboard.writeText(text);
        showStorageIndicator("üìã Mensagem copiada!");
      } catch {
        showStorageIndicator("‚ùå Erro ao copiar!", true);
      }
    });

    // Event listener para reset do emoji
    $("emojiResetBtn").addEventListener("click", () => {
      document.getElementById("emojiInput").value = "üêÉ";
      showStorageIndicator("üêÉ Emoji resetado!");
    });

    // Auto-save emoji no localStorage
    document.getElementById("emojiInput").addEventListener("change", () => {
      const emoji = document.getElementById("emojiInput").value || "üêÉ";
      localStorage.setItem("customReportEmoji", emoji);
      showStorageIndicator("üéâ Emoji personalizado salvo!");
    });

    $("removeSelectedBtn").addEventListener("click", () => {
      const streamer = currentStreamer();
      const checks = Array.from(document.querySelectorAll("#auditBody input[type='checkbox']:checked"));
      if (checks.length === 0) {
        showStorageIndicator("‚ö†Ô∏è Selecione itens primeiro!", true);
        return;
      }
      
      if (confirm(`üóëÔ∏è Remover ${checks.length} item(s) selecionado(s)?`)) {
        const ids = new Set(checks.map(c => c.getAttribute("data-id")));
        state.streamers[streamer].atividades = state.streamers[streamer].atividades.filter(a => !ids.has(a.id));
        saveStateEnhanced(state);
        debouncedRender();
        showStorageIndicator(`üóëÔ∏è ${checks.length} item(s) removido(s)!`);
        calculationCache.clear();
      }
    });

    $("clearAllStreamerBtn").addEventListener("click", () => {
      const streamer = currentStreamer();
      if (confirm(`üí• ATEN√á√ÉO! Isso vai limpar TODOS os dados do streamer ${streamer}. Continuar?`)) {
        state.streamers[streamer].atividades = [];
        saveStateEnhanced(state);
        debouncedRender();
        showStorageIndicator(`üí• Dados do streamer ${streamer} limpos!`);
        calculationCache.clear();
      }
    });

    // Automatic performance stats update
    function updatePerformanceStats() {
      const streamer = currentStreamer();
      const refDateISO = $("refDate").value;

      // Usar a mesma fun√ß√£o de c√°lculo do painel principal para garantir consist√™ncia
      const rWeek = calcularPeriodoStreamer(streamer, "semanal", refDateISO);
      const rMonth = calcularPeriodoStreamer(streamer, "mensal", refDateISO);

      const weekPts = rWeek.pontosPeriodo || 0;
      const monthPts = rMonth.pontosPeriodo || 0;

      // M√©dia di√°ria baseada em dias com atividade no m√™s
      const diasUteis = new Set((rMonth.atividadesPeriodo || []).map(a => a.data)).size;
      const avgDaily = diasUteis > 0 ? Math.round(monthPts / diasUteis) : 0;

      const elWeek = $("perfWeekPoints");
      const elMonth = $("perfMonthPoints");
      const elAvg = $("perfAvgDaily");

      elWeek.textContent = weekPts;
      elMonth.textContent = monthPts;
      elAvg.textContent = avgDaily;

      // Dicas para UX ao passar o mouse
      const weekLabel = labelPeriodo("semanal", refDateISO);
      const monthLabel = labelPeriodo("mensal", refDateISO);
      elWeek.title = `Pontos da semana (${weekLabel})`;
      elMonth.title = `Pontos do m√™s (${monthLabel})`;
      elAvg.title = diasUteis > 0 ? `M√©dia por dia com atividade (${diasUteis} dia(s))` : `Sem dias com atividade no m√™s`;
    }

    // Inicializa√ß√£o
    document.addEventListener('DOMContentLoaded', function() {
      createParticles();
      
      refreshStreamerSelect();
      if (Object.keys(state.streamers).length > 0) {
        $("streamerSelect").value = Object.keys(state.streamers).sort()[0];
      }
      debouncedRender();
      
      if (!state.stats) state.stats = {};
      state.stats.totalSessions = (state.stats.totalSessions || 0) + 1;
      state.stats.lastAccess = Date.now();
      saveStateEnhanced(state);
      
      showStorageIndicator("üêÉ Sistema Atlanta carregado!");
    });

    // Fun√ß√µes para sistema de abas e collapse
    function toggleCollapse(id) {
      const content = document.getElementById(id + '-content');
      const icon = document.getElementById(id + '-icon');
      
      if (content.classList.contains('open')) {
        content.classList.remove('open');
        icon.classList.remove('open');
      } else {
        content.classList.add('open');
        icon.classList.add('open');
      }
    }
  </script>
</body>
</html>
